{"version":3,"sources":["../../../../src/lib/axes/AxisZoomCapture.js"],"names":["React","Component","PropTypes","select","event","d3Event","mouse","touches","mean","first","last","isDefined","noop","mousePosition","d3Window","MOUSEMOVE","MOUSEUP","TOUCHMOVE","TOUCHEND","touchPosition","getTouchProps","sign","AxisZoomCapture","props","handleDragStartMouse","bind","handleDragStartTouch","handleDrag","handleDragEnd","handleRightClick","saveNode","state","startPosition","node","e","stopPropagation","preventDefault","onContextMenu","mouseXY","getBoundingClientRect","on","setState","contextMenuClicked","mouseInteraction","getScale","getMoreProps","startScale","dragHappened","invert","startXY","length","getMouseDelta","inverted","diff","center","range","tempRange","map","d","newDomain","axisZoomCallback","clicked","onDoubleClick","setTimeout","bg","className","zoomCursorClassName","cursor","x","y","h","w","propTypes","innerTickSize","number","outerTickSize","tickFormat","func","tickPadding","tickSize","ticks","tickValues","array","showDomain","bool","showTicks","string","object","isRequired","defaultProps"],"mappings":"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","file":"AxisZoomCapture.js","sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport { select, event as d3Event, mouse, touches } from \"d3-selection\";\r\nimport { mean } from \"d3-array\";\r\n\r\nimport {\r\n\tfirst,\r\n\tlast,\r\n\tisDefined,\r\n\tnoop,\r\n\tmousePosition,\r\n\td3Window,\r\n\tMOUSEMOVE,\r\n\tMOUSEUP,\r\n\tTOUCHMOVE,\r\n\tTOUCHEND,\r\n\ttouchPosition,\r\n\tgetTouchProps,\r\n\tsign,\r\n} from \"../utils\";\r\n\r\nclass AxisZoomCapture extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.handleDragStartMouse = this.handleDragStartMouse.bind(this);\r\n\t\tthis.handleDragStartTouch = this.handleDragStartTouch.bind(this);\r\n\t\tthis.handleDrag = this.handleDrag.bind(this);\r\n\t\tthis.handleDragEnd = this.handleDragEnd.bind(this);\r\n\t\tthis.handleRightClick = this.handleRightClick.bind(this);\r\n\t\tthis.saveNode = this.saveNode.bind(this);\r\n\t\tthis.state = {\r\n\t\t\tstartPosition: null\r\n\t\t};\r\n\t}\r\n\tsaveNode(node) {\r\n\t\tthis.node = node;\r\n\t}\r\n\thandleRightClick(e) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\tconst { onContextMenu } = this.props;\r\n\r\n\t\tconst mouseXY = mousePosition(e, this.node.getBoundingClientRect());\r\n\r\n\t\tselect(d3Window(this.node))\r\n\t\t\t.on(MOUSEMOVE, null)\r\n\t\t\t.on(MOUSEUP, null);\r\n\t\tthis.setState({\r\n\t\t\tstartPosition: null,\r\n\t\t});\r\n\r\n\t\tonContextMenu(mouseXY, e);\r\n\r\n\t\tthis.contextMenuClicked = true;\r\n\t}\r\n\thandleDragStartMouse(e) {\r\n\t\tthis.mouseInteraction = true;\r\n\r\n\t\tconst { getScale, getMoreProps } = this.props;\r\n\t\tconst startScale = getScale(getMoreProps());\r\n\t\tthis.dragHappened = false;\r\n\r\n\t\tif (startScale.invert) {\r\n\t\t\tselect(d3Window(this.node))\r\n\t\t\t\t.on(MOUSEMOVE, this.handleDrag, false)\r\n\t\t\t\t.on(MOUSEUP, this.handleDragEnd, false);\r\n\r\n\t\t\tconst startXY = mousePosition(e);\r\n\r\n\t\t\tthis.setState({\r\n\t\t\t\tstartPosition: {\r\n\t\t\t\t\tstartXY,\r\n\t\t\t\t\tstartScale,\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\te.preventDefault();\r\n\t}\r\n\thandleDragStartTouch(e) {\r\n\t\tthis.mouseInteraction = false;\r\n\r\n\t\tconst { getScale, getMoreProps } = this.props;\r\n\t\tconst startScale = getScale(getMoreProps());\r\n\t\tthis.dragHappened = false;\r\n\r\n\t\tif (e.touches.length === 1 && startScale.invert) {\r\n\t\t\tselect(d3Window(this.node))\r\n\t\t\t\t.on(TOUCHMOVE, this.handleDrag)\r\n\t\t\t\t.on(TOUCHEND, this.handleDragEnd);\r\n\r\n\t\t\tconst startXY = touchPosition(getTouchProps(e.touches[0]), e);\r\n\r\n\t\t\tthis.setState({\r\n\t\t\t\tstartPosition: {\r\n\t\t\t\t\tstartXY,\r\n\t\t\t\t\tstartScale,\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\thandleDrag() {\r\n\t\tconst { startPosition } = this.state;\r\n\t\tconst { getMouseDelta, inverted } = this.props;\r\n\r\n\t\tthis.dragHappened = true;\r\n\t\tif (isDefined(startPosition)) {\r\n\t\t\tconst { startScale } = startPosition;\r\n\t\t\tconst { startXY } = startPosition;\r\n\r\n\t\t\tconst mouseXY = this.mouseInteraction\r\n\t\t\t\t? mouse(this.node)\r\n\t\t\t\t: touches(this.node)[0];\r\n\r\n\t\t\tconst diff = getMouseDelta(startXY, mouseXY);\r\n\r\n\t\t\tconst center = mean(startScale.range());\r\n\r\n\t\t\tconst tempRange = startScale.range()\r\n\t\t\t\t.map(d => inverted ? d - sign(d - center) * diff : d + sign(d - center) * diff);\r\n\r\n\t\t\tconst newDomain = tempRange.map(startScale.invert);\r\n\r\n\t\t\tif (sign(last(startScale.range()) - first(startScale.range())) === sign(last(tempRange) - first(tempRange))) {\r\n\r\n\t\t\t\tconst { axisZoomCallback } = this.props;\r\n\t\t\t\t// console.log(startXScale.domain(), newXDomain)\r\n\t\t\t\taxisZoomCallback(newDomain);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\thandleDragEnd() {\r\n\r\n\t\tif (!this.dragHappened) {\r\n\t\t\tif (this.clicked) {\r\n\t\t\t\tconst e = d3Event;\r\n\t\t\t\tconst mouseXY = this.mouseInteraction\r\n\t\t\t\t\t? mouse(this.node)\r\n\t\t\t\t\t: touches(this.node)[0];\r\n\t\t\t\tconst { onDoubleClick } = this.props;\r\n\r\n\t\t\t\tonDoubleClick(mouseXY, e);\r\n\t\t\t} else {\r\n\t\t\t\tthis.clicked = true;\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.clicked = false;\r\n\t\t\t\t}, 300);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tselect(d3Window(this.node))\r\n\t\t\t.on(MOUSEMOVE, null)\r\n\t\t\t.on(MOUSEUP, null)\r\n\t\t\t.on(TOUCHMOVE, null)\r\n\t\t\t.on(TOUCHEND, null);\r\n\r\n\t\tthis.setState({\r\n\t\t\tstartPosition: null,\r\n\t\t});\r\n\t}\r\n\trender() {\r\n\t\tconst { bg, className, zoomCursorClassName } = this.props;\r\n\r\n\t\tconst cursor = isDefined(this.state.startPosition)\r\n\t\t\t? zoomCursorClassName\r\n\t\t\t: \"react-stockcharts-default-cursor\";\r\n\r\n\t\treturn <rect\r\n\t\t\tclassName={`react-stockcharts-enable-interaction ${cursor} ${className}`}\r\n\t\t\tref={this.saveNode}\r\n\t\t\tx={bg.x} y={bg.y} opacity={0} height={bg.h} width={bg.w}\r\n\t\t\tonContextMenu={this.handleRightClick}\r\n\t\t\tonMouseDown={this.handleDragStartMouse}\r\n\t\t\tonTouchStart={this.handleDragStartTouch}\r\n\t\t/>;\r\n\t}\r\n}\r\n\r\nAxisZoomCapture.propTypes = {\r\n\tinnerTickSize: PropTypes.number,\r\n\touterTickSize: PropTypes.number,\r\n\ttickFormat: PropTypes.func,\r\n\ttickPadding: PropTypes.number,\r\n\ttickSize: PropTypes.number,\r\n\tticks: PropTypes.number,\r\n\ttickValues: PropTypes.array,\r\n\tshowDomain: PropTypes.bool,\r\n\tshowTicks: PropTypes.bool,\r\n\tclassName: PropTypes.string,\r\n\taxisZoomCallback: PropTypes.func,\r\n\tinverted: PropTypes.bool,\r\n\tbg: PropTypes.object.isRequired,\r\n\tzoomCursorClassName: PropTypes.string.isRequired,\r\n\tgetMoreProps: PropTypes.func.isRequired,\r\n\tgetScale: PropTypes.func.isRequired,\r\n\tgetMouseDelta: PropTypes.func.isRequired,\r\n\tonDoubleClick: PropTypes.func.isRequired,\r\n\tonContextMenu: PropTypes.func.isRequired,\r\n};\r\n\r\nAxisZoomCapture.defaultProps = {\r\n\tonDoubleClick: noop,\r\n\tonContextMenu: noop,\r\n\tinverted: true\r\n};\r\n\r\nexport default AxisZoomCapture;\r\n"]}