{"version":3,"sources":["../../../../src/lib/indicator/elderImpulse.js"],"names":["rebind","isDefined","isNotDefined","merge","slidingWindow","ElderImpulse","appearanceOptions","baseIndicator","ALGORITHM_TYPE","macdSource","emaSource","base","type","stroke","fill","undefined","underlyingAlgorithm","windowSize","undefinedValue","accumulator","prev","curr","Error","prevMACDDivergence","divergence","currMACDDivergence","prevEMA","currEMA","mergedAlgorithm","algorithm","datum","indicator","elderImpulse","data","options","newData","x","arguments","length"],"mappings":";;AAEA,SAASA,MAAT,EAAiBC,SAAjB,EAA4BC,YAA5B,EAA0CC,KAA1C,EAAiDC,aAAjD,QAAsE,UAAtE;;AAEA,SAASC,gBAAgBC,iBAAzB,QAAkD,+BAAlD;AACA,OAAOC,aAAP,MAA0B,iBAA1B;;AAEA,IAAMC,iBAAiB,cAAvB;;AAEA,eAAe,YAAW;;AAEzB,KAAIC,mBAAJ;AAAA,KAAgBC,kBAAhB;;AAEA,KAAMC,OAAOJ,gBACXK,IADW,CACNJ,cADM;AAEZ;AAFY,EAGXK,MAHW,CAGJP,kBAAkBO,MAHd,EAIXC,IAJW,CAINC,SAJM,CAAb;;AAMA,KAAMC,sBAAsBZ,gBAC1Ba,UAD0B,CACf,CADe,EAE1BC,cAF0B,CAEX,SAFW,EAG1BC,WAH0B,CAGd,gBAAkB;AAAA;AAAA,MAAhBC,IAAgB;AAAA,MAAVC,IAAU;;AAC9B,MAAInB,aAAaO,UAAb,CAAJ,EAA8B,MAAM,IAAIa,KAAJ,iCAAwCd,cAAxC,iBAAN;AAC9B,MAAIN,aAAaQ,SAAb,CAAJ,EAA6B,MAAM,IAAIY,KAAJ,gCAAuCd,cAAvC,iBAAN;;AAE7B,MAAIP,UAAUQ,WAAWW,IAAX,CAAV,KAA+BnB,UAAUS,UAAUU,IAAV,CAAV,CAAnC,EAA+D;AAC9D,OAAMG,qBAAqBd,WAAWW,IAAX,EAAiBI,UAA5C;AACA,OAAMC,qBAAqBhB,WAAWY,IAAX,EAAiBG,UAA5C;;AAEA,OAAME,UAAUhB,UAAUU,IAAV,CAAhB;AACA,OAAMO,UAAUjB,UAAUW,IAAV,CAAhB;;AAEA,OAAII,sBAAsBF,kBAAtB,IACAI,WAAWD,OADf,EACwB,OAAO,IAAP;;AAExB,OAAID,sBAAsBF,kBAAtB,IACAI,WAAWD,OADf,EACwB,OAAO,MAAP;AACxB;AACD,SAAO,SAAP;AACA,EArB0B,CAA5B;;AAuBA,KAAME,kBAAkBzB,QACtB0B,SADsB,CACZb,mBADY,EAEtBb,KAFsB,CAEhB,UAAC2B,KAAD,EAAQC,SAAR,EAAsB;AAAED,QAAME,YAAN,GAAqBD,SAArB;AAAiC,EAFzC,CAAxB;;AAIA;AACA,KAAIA,YAAY,SAAZA,SAAY,CAASE,IAAT,EAA0C;AAAA,MAA3BC,OAA2B,uEAAjB,EAAE/B,OAAO,IAAT,EAAiB;;AACzD,MAAMgC,UAAUD,QAAQ/B,KAAR,GACbyB,gBAAgBK,IAAhB,CADa,GAEbjB,oBAAoBiB,IAApB,CAFH;;AAIA,SAAOE,OAAP;AACA,EAND;AAOAJ,WAAUtB,UAAV,GAAuB,UAAS2B,CAAT,EAAY;AAClC,MAAI,CAACC,UAAUC,MAAf,EAAuB,OAAO7B,UAAP;AACvBA,eAAa2B,CAAb;AACA,SAAOL,SAAP;AACA,EAJD;AAKAA,WAAUrB,SAAV,GAAsB,UAAS0B,CAAT,EAAY;AACjC,MAAI,CAACC,UAAUC,MAAf,EAAuB,OAAO5B,SAAP;AACvBA,cAAY0B,CAAZ;AACA,SAAOL,SAAP;AACA,EAJD;AAKA/B,QAAO+B,SAAP,EAAkBpB,IAAlB,EAAwB,IAAxB,EAA8B,MAA9B,EAAsC,MAAtC,EAA8C,QAA9C;AACA;AACAX,QAAO+B,SAAP,EAAkBH,eAAlB,EAAmC,OAAnC,EAA4C,eAA5C;;AAEA,QAAOG,SAAP;AACA","file":"elderImpulse.js","sourcesContent":["\r\n\r\nimport { rebind, isDefined, isNotDefined, merge, slidingWindow } from \"../utils\";\r\n\r\nimport { ElderImpulse as appearanceOptions } from \"./defaultOptionsForAppearance\";\r\nimport baseIndicator from \"./baseIndicator\";\r\n\r\nconst ALGORITHM_TYPE = \"ElderImpulse\";\r\n\r\nexport default function() {\r\n\r\n\tlet macdSource, emaSource;\r\n\r\n\tconst base = baseIndicator()\r\n\t\t.type(ALGORITHM_TYPE)\r\n\t\t// .stroke(d => stroke[d.elderImpulse])\r\n\t\t.stroke(appearanceOptions.stroke)\r\n\t\t.fill(undefined);\r\n\r\n\tconst underlyingAlgorithm = slidingWindow()\r\n\t\t.windowSize(2)\r\n\t\t.undefinedValue(\"neutral\")\r\n\t\t.accumulator(([prev, curr]) => {\r\n\t\t\tif (isNotDefined(macdSource)) throw new Error(`macdSource not defined for ${ALGORITHM_TYPE} calculator`);\r\n\t\t\tif (isNotDefined(emaSource)) throw new Error(`emaSource not defined for ${ALGORITHM_TYPE} calculator`);\r\n\r\n\t\t\tif (isDefined(macdSource(prev)) && isDefined(emaSource(prev))) {\r\n\t\t\t\tconst prevMACDDivergence = macdSource(prev).divergence;\r\n\t\t\t\tconst currMACDDivergence = macdSource(curr).divergence;\r\n\r\n\t\t\t\tconst prevEMA = emaSource(prev);\r\n\t\t\t\tconst currEMA = emaSource(curr);\r\n\r\n\t\t\t\tif (currMACDDivergence >= prevMACDDivergence\r\n\t\t\t\t\t&& currEMA >= prevEMA) return \"up\";\r\n\r\n\t\t\t\tif (currMACDDivergence <= prevMACDDivergence\r\n\t\t\t\t\t&& currEMA <= prevEMA) return \"down\";\r\n\t\t\t}\r\n\t\t\treturn \"neutral\";\r\n\t\t});\r\n\r\n\tconst mergedAlgorithm = merge()\r\n\t\t.algorithm(underlyingAlgorithm)\r\n\t\t.merge((datum, indicator) => { datum.elderImpulse = indicator; });\r\n\r\n\t// eslint-disable-next-line prefer-const\r\n\tlet indicator = function(data, options = { merge: true }) {\r\n\t\tconst newData = options.merge\r\n\t\t\t? mergedAlgorithm(data)\r\n\t\t\t: underlyingAlgorithm(data);\r\n\r\n\t\treturn newData;\r\n\t};\r\n\tindicator.macdSource = function(x) {\r\n\t\tif (!arguments.length) return macdSource;\r\n\t\tmacdSource = x;\r\n\t\treturn indicator;\r\n\t};\r\n\tindicator.emaSource = function(x) {\r\n\t\tif (!arguments.length) return emaSource;\r\n\t\temaSource = x;\r\n\t\treturn indicator;\r\n\t};\r\n\trebind(indicator, base, \"id\", \"echo\", \"type\", \"stroke\");\r\n\t// rebind(indicator, underlyingAlgorithm, \"windowSize\", \"movingAverageType\", \"multiplier\", \"source\");\r\n\trebind(indicator, mergedAlgorithm, \"merge\", \"skipUndefined\");\r\n\r\n\treturn indicator;\r\n}\r\n"]}