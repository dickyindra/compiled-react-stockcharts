{"version":3,"sources":["../../../src/lib/ChartCanvas.js"],"names":["React","Component","PropTypes","extent","d3Extent","min","max","head","last","isDefined","isNotDefined","clearCanvas","shallowEqual","identity","noop","functor","getLogger","mouseBasedZoomAnchor","lastVisibleItemBasedZoomAnchor","rightDomainBasedZoomAnchor","getNewChartConfig","getChartConfigWithUpdatedYScales","getCurrentCharts","getCurrentItem","EventCapture","CanvasContainer","evaluator","log","CANDIDATES_FOR_RESET","shouldResetChart","thisProps","nextProps","every","result","key","getCursorStyle","tooltipStyle","getDimensions","props","height","margin","top","bottom","width","left","right","getXScaleDirection","flipXScale","calculateFullData","fullData","data","plotFull","xScale","clamp","pointsPerPxThreshold","xAccessor","displayXAccessor","minPointsPerPxThreshold","useWholeData","filterData","copy","resetChart","firstCalculation","process","env","NODE_ENV","state","calculateState","initialPlotData","plotData","postCalculator","children","dimensions","chartConfig","domain","updateChart","newState","initialXScale","lastItemWasVisible","initialChartConfig","lastItem","start","end","padding","maintainPointsPerPixelOnResize","direction","updatedXScale","setXRange","range","rangeStart","rangeEnd","newRangeStart","newRangeEnd","newDomainExtent","newStart","lastItemX","response","fallbackStart","fallbackEnd","dx","map","x","invert","newEnd","inputXAccesor","xExtentsProp","xExtents","i","length","prev","curr","Error","d","each","rangeRoundPoints","isNaN","pinchCoordinates","pinch","touch1Pos","touch2Pos","topLeft","Math","bottomRight","ChartCanvas","getDataInfo","bind","getCanvasContexts","handleMouseMove","handleMouseEnter","handleMouseLeave","handleZoom","handlePinchZoom","handlePinchZoomEnd","handlePan","handlePanEnd","handleClick","handleMouseDown","handleDoubleClick","handleContextMenu","handleDragStart","handleDrag","handleDragEnd","panHelper","pinchZoomHelper","xAxisZoom","yAxisZoom","resetYDomain","calculateStateForDomain","generateSubscriptionId","draw","redraw","getAllPanConditions","subscriptions","subscribe","unsubscribe","amIOnTop","saveEventCaptureNode","saveCanvasContainerNode","setCursorClass","getMutableState","interactiveState","panInProgress","mutableState","lastSubscriptionId","node","eventCaptureNode","canvasContainerNode","canvases","axes","mouseCoord","ratio","bg","id","rest","getPanConditions","draggable","panEnabled","concat","filter","className","dragableComponents","mouseXY","e","currentCharts","currentItem","triggerEvent","newDomain","currentPlotData","currentDomain","beforePlotData","updatedScale","initialPinch","finalPinch","initialPinchXScale","iTL","iBR","fTL","fBR","xDash","round","yDash","y","cancelDrag","waitingForPinchZoomAnimationFrame","requestAnimationFrame","clearBothCanvas","trigger","clearThreeCanvas","firstItem","onLoadMore","setState","zoomDirection","zoomMultiplier","zoomAnchor","item","cx","c","show","chartId","yScale","yPanEnabled","type","forEach","listener","force","chartsToPan","dy","hackyWayToStopPanBeyondBounds__plotData","hackyWayToStopPanBeyondBounds__domain","mousePosition","panStartXScale","dxdy","waitingForPanAnimationFrame","inputType","waitingForMouseMoveAnimationFrame","prevMouseXY","clearMouseCanvas","startPos","chartCanvasType","reset","interaction","isInteractionEnabled","prevLastItem","calculatedState","changed","newChartConfig","realYDomain","zIndex","defaultFocus","mouseMoveEvent","panEvent","zoomEvent","useCrossHairStyleCursor","onSelect","cursorStyle","cursor","position","idx","disableInteraction","propTypes","number","isRequired","object","oneOf","array","func","oneOfType","string","seriesName","bool","shape","propName","console","warn","defaultProps","childContextTypes","arrayOf","origin","yExtents","yExtentsProvider","mouseCoordinates","at","format","ohlcv","date","open","high","low","close","volume"],"mappings":"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","file":"ChartCanvas.js","sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport { extent as d3Extent, min, max } from \"d3-array\";\r\n\r\nimport {\r\n\thead,\r\n\tlast,\r\n\tisDefined,\r\n\tisNotDefined,\r\n\tclearCanvas,\r\n\tshallowEqual,\r\n\tidentity,\r\n\tnoop,\r\n\tfunctor,\r\n\tgetLogger,\r\n} from \"./utils\";\r\n\r\n/* eslint-disable no-unused-vars */\r\nimport {\r\n\tmouseBasedZoomAnchor,\r\n\tlastVisibleItemBasedZoomAnchor,\r\n\trightDomainBasedZoomAnchor,\r\n} from \"./utils/zoomBehavior\";\r\n/* eslint-enable no-unused-vars */\r\n\r\nimport { getNewChartConfig, getChartConfigWithUpdatedYScales, getCurrentCharts, getCurrentItem } from \"./utils/ChartDataUtil\";\r\n\r\nimport EventCapture from \"./EventCapture\";\r\n\r\nimport CanvasContainer from \"./CanvasContainer\";\r\nimport evaluator from \"./scale/evaluator\";\r\n\r\nconst log = getLogger(\"ChartCanvas\");\r\n\r\nconst CANDIDATES_FOR_RESET = [\r\n\t\"seriesName\",\r\n\t/* \"data\",*/\r\n\t/* \"xAccessor\",*/\r\n];\r\n\r\nfunction shouldResetChart(thisProps, nextProps) {\r\n\treturn !CANDIDATES_FOR_RESET.every(key => {\r\n\t\tconst result = shallowEqual(thisProps[key], nextProps[key]);\r\n\t\t// console.log(key, result);\r\n\t\treturn result;\r\n\t});\r\n}\r\n\r\nfunction getCursorStyle() {\r\n\tconst tooltipStyle = `\r\n\t.react-stockcharts-grabbing-cursor {\r\n\t\tpointer-events: all;\r\n\t\tcursor: -moz-grabbing;\r\n\t\tcursor: -webkit-grabbing;\r\n\t\tcursor: grabbing;\r\n\t}\r\n\t.react-stockcharts-crosshair-cursor {\r\n\t\tpointer-events: all;\r\n\t\tcursor: crosshair;\r\n\t}\r\n\t.react-stockcharts-tooltip-hover {\r\n\t\tpointer-events: all;\r\n\t\tcursor: pointer;\r\n\t}\r\n\t.react-stockcharts-avoid-interaction {\r\n\t\tpointer-events: none;\r\n\t}\r\n\t.react-stockcharts-enable-interaction {\r\n\t\tpointer-events: all;\r\n\t}\r\n\t.react-stockcharts-tooltip {\r\n\t\tpointer-events: all;\r\n\t\tcursor: pointer;\r\n\t}\r\n\t.react-stockcharts-default-cursor {\r\n\t\tcursor: default;\r\n\t}\r\n\t.react-stockcharts-move-cursor {\r\n\t\tcursor: move;\r\n\t}\r\n\t.react-stockcharts-pointer-cursor {\r\n\t\tcursor: pointer;\r\n\t}\r\n\t.react-stockcharts-ns-resize-cursor {\r\n\t\tcursor: ns-resize;\r\n\t}\r\n\t.react-stockcharts-ew-resize-cursor {\r\n\t\tcursor: ew-resize;\r\n\t}`;\r\n\treturn (<style type=\"text/css\">{tooltipStyle}</style>);\r\n}\r\n\r\nfunction getDimensions(props) {\r\n\treturn {\r\n\t\theight: props.height - props.margin.top - props.margin.bottom,\r\n\t\twidth: props.width - props.margin.left - props.margin.right,\r\n\t};\r\n}\r\n\r\nfunction getXScaleDirection(flipXScale) {\r\n\treturn flipXScale ? -1 : 1;\r\n}\r\n\r\nfunction calculateFullData(props) {\r\n\tconst { data: fullData, plotFull, xScale, clamp, pointsPerPxThreshold, flipXScale } = props;\r\n\tconst { xAccessor, displayXAccessor, minPointsPerPxThreshold } = props;\r\n\r\n\tconst useWholeData = isDefined(plotFull)\r\n\t\t? plotFull\r\n\t\t: xAccessor === identity;\r\n\r\n\tconst { filterData } = evaluator({\r\n\t\txScale,\r\n\t\tuseWholeData,\r\n\t\tclamp,\r\n\t\tpointsPerPxThreshold,\r\n\t\tminPointsPerPxThreshold,\r\n\t\tflipXScale,\r\n\t});\r\n\r\n\treturn {\r\n\t\txAccessor,\r\n\t\tdisplayXAccessor: displayXAccessor || xAccessor,\r\n\t\txScale: xScale.copy(),\r\n\t\tfullData,\r\n\t\tfilterData\r\n\t};\r\n}\r\nfunction resetChart(props, firstCalculation = false) {\r\n\tif (process.env.NODE_ENV !== \"production\") {\r\n\t\tif (!firstCalculation) log(\"CHART RESET\");\r\n\t}\r\n\r\n\tconst state = calculateState(props);\r\n\tconst { xAccessor, displayXAccessor, fullData } = state;\r\n\tconst { plotData: initialPlotData, xScale } = state;\r\n\tconst { postCalculator, children } = props;\r\n\r\n\tconst plotData = postCalculator(initialPlotData);\r\n\r\n\tconst dimensions = getDimensions(props);\r\n\tconst chartConfig = getChartConfigWithUpdatedYScales(\r\n\t\tgetNewChartConfig(dimensions, children),\r\n\t\t{ plotData, xAccessor, displayXAccessor, fullData },\r\n\t\txScale.domain()\r\n\t);\r\n\r\n\treturn {\r\n\t\t...state,\r\n\t\txScale,\r\n\t\tplotData,\r\n\t\tchartConfig,\r\n\t};\r\n}\r\n\r\nfunction updateChart(\r\n\tnewState,\r\n\tinitialXScale,\r\n\tprops,\r\n\tlastItemWasVisible,\r\n\tinitialChartConfig,\r\n) {\r\n\r\n\tconst { fullData, xScale, xAccessor, displayXAccessor, filterData } = newState;\r\n\r\n\tconst lastItem = last(fullData);\r\n\tconst [start, end] = initialXScale.domain();\r\n\r\n\tif (process.env.NODE_ENV !== \"production\") {\r\n\t\tlog(\"TRIVIAL CHANGE\");\r\n\t}\r\n\r\n\tconst { postCalculator, children, padding, flipXScale } = props;\r\n\tconst { maintainPointsPerPixelOnResize } = props;\r\n\tconst direction = getXScaleDirection(flipXScale);\r\n\tconst dimensions = getDimensions(props);\r\n\r\n\tconst updatedXScale = setXRange(xScale, dimensions, padding, direction);\r\n\r\n\t// console.log(\"lastItemWasVisible =\", lastItemWasVisible, end, xAccessor(lastItem), end >= xAccessor(lastItem));\r\n\tlet initialPlotData;\r\n\tif (!lastItemWasVisible || end >= xAccessor(lastItem)) {\r\n\t\t// resize comes here...\r\n\t\t// get plotData between [start, end] and do not change the domain\r\n\t\tconst [rangeStart, rangeEnd] = initialXScale.range();\r\n\t\tconst [newRangeStart, newRangeEnd] = updatedXScale.range();\r\n\t\tconst newDomainExtent = ((newRangeEnd - newRangeStart) / (rangeEnd - rangeStart)) * (end - start);\r\n\t\tconst newStart = maintainPointsPerPixelOnResize\r\n\t\t\t? end - newDomainExtent\r\n\t\t\t: start;\r\n\r\n\t\tconst lastItemX = initialXScale(xAccessor(lastItem));\r\n\t\t// console.log(\"pointsPerPixel => \", newStart, start, end, updatedXScale(end));\r\n\t\tconst response = filterData(\r\n\t\t\tfullData, [newStart, end], xAccessor, updatedXScale,\r\n\t\t\t{ fallbackStart: start, fallbackEnd: { lastItem, lastItemX } }\r\n\t\t);\r\n\t\tinitialPlotData = response.plotData;\r\n\t\tupdatedXScale.domain(response.domain);\r\n\t\t// console.log(\"HERE!!!!!\", start, end);\r\n\t} else if (lastItemWasVisible\r\n\t\t\t&& end < xAccessor(lastItem)) {\r\n\t\t// this is when a new item is added and last item was visible\r\n\t\t// so slide over and show the new item also\r\n\r\n\t\t// get plotData between [xAccessor(l) - (end - start), xAccessor(l)] and DO change the domain\r\n\t\tconst dx = initialXScale(xAccessor(lastItem)) - initialXScale.range()[1];\r\n\t\tconst [newStart, newEnd] = initialXScale.range().map(x => x + dx).map(initialXScale.invert);\r\n\r\n\r\n\t\tconst response = filterData(fullData, [newStart, newEnd], xAccessor, updatedXScale);\r\n\t\tinitialPlotData = response.plotData;\r\n\t\tupdatedXScale.domain(response.domain);\t\t// if last item was visible, then shift\r\n\t}\r\n\t// plotData = getDataOfLength(fullData, showingInterval, plotData.length)\r\n\tconst plotData = postCalculator(initialPlotData);\r\n\tconst chartConfig = getChartConfigWithUpdatedYScales(\r\n\t\tgetNewChartConfig(dimensions, children, initialChartConfig),\r\n\t\t{ plotData, xAccessor, displayXAccessor, fullData },\r\n\t\tupdatedXScale.domain()\r\n\t);\r\n\r\n\treturn {\r\n\t\txScale: updatedXScale,\r\n\t\txAccessor,\r\n\t\tchartConfig,\r\n\t\tplotData,\r\n\t\tfullData,\r\n\t\tfilterData,\r\n\t};\r\n}\r\n\r\nfunction calculateState(props) {\r\n\r\n\tconst {\r\n\t\txAccessor: inputXAccesor, xExtents: xExtentsProp, data, padding, flipXScale\r\n\t} = props;\r\n\r\n\tif (process.env.NODE_ENV !== \"production\" && isDefined(props.xScale.invert)) {\r\n\t\tfor (let i = 1; i < data.length; i++) {\r\n\t\t\tconst prev = data[i - 1];\r\n\t\t\tconst curr = data[i];\r\n\t\t\tif (inputXAccesor(prev) > inputXAccesor(curr)) {\r\n\t\t\t\tthrow new Error(\"'data' is not sorted on 'xAccessor', send 'data' sorted in ascending order of 'xAccessor'\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tconst direction = getXScaleDirection(flipXScale);\r\n\tconst dimensions = getDimensions(props);\r\n\r\n\tconst extent = typeof xExtentsProp === \"function\"\r\n\t\t? xExtentsProp(data)\r\n\t\t: d3Extent(xExtentsProp.map(d => functor(d)).map(each => each(data, inputXAccesor)));\r\n\r\n\tconst { xAccessor, displayXAccessor, xScale, fullData, filterData } = calculateFullData(props);\r\n\tconst updatedXScale = setXRange(xScale, dimensions, padding, direction);\r\n\r\n\tconst { plotData, domain } = filterData(fullData, extent, inputXAccesor, updatedXScale);\r\n\r\n\treturn {\r\n\t\tplotData,\r\n\t\txScale: updatedXScale.domain(domain),\r\n\t\txAccessor,\r\n\t\tdisplayXAccessor,\r\n\t\tfullData,\r\n\t\tfilterData,\r\n\t};\r\n}\r\n\r\nfunction setXRange(xScale, dimensions, padding, direction = 1) {\r\n\tif (xScale.rangeRoundPoints) {\r\n\t\tif (isNaN(padding)) throw new Error(\"padding has to be a number for ordinal scale\");\r\n\t\txScale.rangeRoundPoints([0, dimensions.width], padding);\r\n\t} else if (xScale.padding) {\r\n\t\tif (isNaN(padding)) throw new Error(\"padding has to be a number for ordinal scale\");\r\n\t\txScale.range([0, dimensions.width]);\r\n\t\txScale.padding(padding / 2);\r\n\t} else {\r\n\t\tconst { left, right } = isNaN(padding)\r\n\t\t\t? padding\r\n\t\t\t: { left: padding, right: padding };\r\n\t\tif (direction > 0) {\r\n\t\t\txScale.range([left, dimensions.width - right]);\r\n\t\t} else {\r\n\t\t\txScale.range([dimensions.width - right, left]);\r\n\t\t}\r\n\t}\r\n\treturn xScale;\r\n}\r\n\r\nfunction pinchCoordinates(pinch) {\r\n\tconst { touch1Pos, touch2Pos } = pinch;\r\n\r\n\treturn {\r\n\t\ttopLeft: [Math.min(touch1Pos[0], touch2Pos[0]), Math.min(touch1Pos[1], touch2Pos[1])],\r\n\t\tbottomRight: [Math.max(touch1Pos[0], touch2Pos[0]), Math.max(touch1Pos[1], touch2Pos[1])]\r\n\t};\r\n}\r\n\r\n\r\nclass ChartCanvas extends Component {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.getDataInfo = this.getDataInfo.bind(this);\r\n\t\tthis.getCanvasContexts = this.getCanvasContexts.bind(this);\r\n\r\n\t\tthis.handleMouseMove = this.handleMouseMove.bind(this);\r\n\t\tthis.handleMouseEnter = this.handleMouseEnter.bind(this);\r\n\t\tthis.handleMouseLeave = this.handleMouseLeave.bind(this);\r\n\t\tthis.handleZoom = this.handleZoom.bind(this);\r\n\t\tthis.handlePinchZoom = this.handlePinchZoom.bind(this);\r\n\t\tthis.handlePinchZoomEnd = this.handlePinchZoomEnd.bind(this);\r\n\t\tthis.handlePan = this.handlePan.bind(this);\r\n\t\tthis.handlePanEnd = this.handlePanEnd.bind(this);\r\n\t\tthis.handleClick = this.handleClick.bind(this);\r\n\t\tthis.handleMouseDown = this.handleMouseDown.bind(this);\r\n\t\tthis.handleDoubleClick = this.handleDoubleClick.bind(this);\r\n\t\tthis.handleContextMenu = this.handleContextMenu.bind(this);\r\n\t\tthis.handleDragStart = this.handleDragStart.bind(this);\r\n\t\tthis.handleDrag = this.handleDrag.bind(this);\r\n\t\tthis.handleDragEnd = this.handleDragEnd.bind(this);\r\n\r\n\t\tthis.panHelper = this.panHelper.bind(this);\r\n\t\tthis.pinchZoomHelper = this.pinchZoomHelper.bind(this);\r\n\t\tthis.xAxisZoom = this.xAxisZoom.bind(this);\r\n\t\tthis.yAxisZoom = this.yAxisZoom.bind(this);\r\n\t\tthis.resetYDomain = this.resetYDomain.bind(this);\r\n\t\tthis.calculateStateForDomain = this.calculateStateForDomain.bind(this);\r\n\t\tthis.generateSubscriptionId = this.generateSubscriptionId.bind(this);\r\n\t\tthis.draw = this.draw.bind(this);\r\n\t\tthis.redraw = this.redraw.bind(this);\r\n\t\tthis.getAllPanConditions = this.getAllPanConditions.bind(this);\r\n\r\n\t\tthis.subscriptions = [];\r\n\t\tthis.subscribe = this.subscribe.bind(this);\r\n\t\tthis.unsubscribe = this.unsubscribe.bind(this);\r\n\t\tthis.amIOnTop = this.amIOnTop.bind(this);\r\n\t\tthis.saveEventCaptureNode = this.saveEventCaptureNode.bind(this);\r\n\t\tthis.saveCanvasContainerNode = this.saveCanvasContainerNode.bind(this);\r\n\t\tthis.setCursorClass = this.setCursorClass.bind(this);\r\n\t\tthis.getMutableState = this.getMutableState.bind(this);\r\n\t\t// this.canvasDrawCallbackList = [];\r\n\t\tthis.interactiveState = [];\r\n\t\tthis.panInProgress = false;\r\n\r\n\t\tthis.state = {};\r\n\t\tthis.mutableState = {};\r\n\t\tthis.lastSubscriptionId = 0;\r\n\t}\r\n\tsaveEventCaptureNode(node) {\r\n\t\tthis.eventCaptureNode = node;\r\n\t}\r\n\tsaveCanvasContainerNode(node) {\r\n\t\tthis.canvasContainerNode = node;\r\n\t}\r\n\tgetMutableState() {\r\n\t\treturn this.mutableState;\r\n\t}\r\n\tgetDataInfo() {\r\n\t\treturn {\r\n\t\t\t...this.state,\r\n\t\t\tfullData: this.fullData,\r\n\t\t};\r\n\t}\r\n\tgetCanvasContexts() {\r\n\t\tif (this.canvasContainerNode) {\r\n\t\t\treturn this.canvasContainerNode.getCanvasContexts();\r\n\t\t}\r\n\t}\r\n\tgenerateSubscriptionId() {\r\n\t\tthis.lastSubscriptionId++;\r\n\t\treturn this.lastSubscriptionId;\r\n\t}\r\n\tclearBothCanvas() {\r\n\t\tconst canvases = this.getCanvasContexts();\r\n\t\tif (canvases && canvases.axes) {\r\n\t\t\tclearCanvas([\r\n\t\t\t\tcanvases.axes,\r\n\t\t\t\t// canvases.hover,\r\n\t\t\t\tcanvases.mouseCoord\r\n\t\t\t], this.props.ratio);\r\n\t\t}\r\n\t}\r\n\tclearMouseCanvas() {\r\n\t\tconst canvases = this.getCanvasContexts();\r\n\t\tif (canvases && canvases.mouseCoord) {\r\n\t\t\tclearCanvas([\r\n\t\t\t\tcanvases.mouseCoord,\r\n\t\t\t\t// canvases.hover,\r\n\t\t\t], this.props.ratio);\r\n\t\t}\r\n\t}\r\n\tclearThreeCanvas() {\r\n\t\tconst canvases = this.getCanvasContexts();\r\n\t\tif (canvases && canvases.axes) {\r\n\t\t\tclearCanvas([\r\n\t\t\t\tcanvases.axes,\r\n\t\t\t\t// canvases.hover,\r\n\t\t\t\tcanvases.mouseCoord,\r\n\t\t\t\tcanvases.bg\r\n\t\t\t], this.props.ratio);\r\n\t\t}\r\n\t}\r\n\tsubscribe(id, rest) {\r\n\t\tconst { getPanConditions = functor({\r\n\t\t\tdraggable: false,\r\n\t\t\tpanEnabled: true,\r\n\t\t}) } = rest;\r\n\t\tthis.subscriptions = this.subscriptions.concat({\r\n\t\t\tid,\r\n\t\t\t...rest,\r\n\t\t\tgetPanConditions,\r\n\t\t});\r\n\t}\r\n\tunsubscribe(id) {\r\n\t\tthis.subscriptions = this.subscriptions.filter(each => each.id !== id);\r\n\t}\r\n\tgetAllPanConditions() {\r\n\t\treturn this.subscriptions\r\n\t\t\t.map(each => each.getPanConditions());\r\n\t}\r\n\tsetCursorClass(className) {\r\n\t\tif (this.eventCaptureNode != null) {\r\n\t\t\tthis.eventCaptureNode.setCursorClass(className);\r\n\t\t}\r\n\t}\r\n\tamIOnTop(id) {\r\n\t\tconst dragableComponents = this.subscriptions\r\n\t\t\t.filter(each => each.getPanConditions().draggable);\r\n\r\n\t\treturn dragableComponents.length > 0\r\n\t\t\t&& last(dragableComponents).id === id;\r\n\t}\r\n\thandleContextMenu(mouseXY, e) {\r\n\t\tconst { xAccessor, chartConfig, plotData, xScale } = this.state;\r\n\r\n\t\tconst currentCharts = getCurrentCharts(chartConfig, mouseXY);\r\n\t\tconst currentItem = getCurrentItem(xScale, xAccessor, mouseXY, plotData);\r\n\r\n\t\tthis.triggerEvent(\"contextmenu\", {\r\n\t\t\tmouseXY,\r\n\t\t\tcurrentItem,\r\n\t\t\tcurrentCharts,\r\n\t\t}, e);\r\n\t}\r\n\tcalculateStateForDomain(newDomain) {\r\n\t\tconst {\r\n\t\t\txAccessor,\r\n\t\t\tdisplayXAccessor,\r\n\t\t\txScale: initialXScale,\r\n\t\t\tchartConfig: initialChartConfig,\r\n\t\t\tplotData: initialPlotData\r\n\t\t} = this.state;\r\n\t\tconst { filterData } = this.state;\r\n\t\tconst { fullData } = this;\r\n\t\tconst { postCalculator } = this.props;\r\n\r\n\t\tconst { plotData: beforePlotData, domain } = filterData(\r\n\t\t\tfullData,\r\n\t\t\tnewDomain,\r\n\t\t\txAccessor,\r\n\t\t\tinitialXScale,\r\n\t\t\t{\r\n\t\t\t\tcurrentPlotData: initialPlotData,\r\n\t\t\t\tcurrentDomain: initialXScale.domain()\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tconst plotData = postCalculator(beforePlotData);\r\n\t\tconst updatedScale = initialXScale.copy().domain(domain);\r\n\t\tconst chartConfig = getChartConfigWithUpdatedYScales(\r\n\t\t\tinitialChartConfig,\r\n\t\t\t{ plotData, xAccessor, displayXAccessor, fullData },\r\n\t\t\tupdatedScale.domain()\r\n\t\t);\r\n\r\n\t\treturn {\r\n\t\t\txScale: updatedScale,\r\n\t\t\tplotData,\r\n\t\t\tchartConfig,\r\n\t\t};\r\n\t}\r\n\tpinchZoomHelper(initialPinch, finalPinch) {\r\n\t\tconst { xScale: initialPinchXScale } = initialPinch;\r\n\r\n\t\tconst {\r\n\t\t\txScale: initialXScale,\r\n\t\t\tchartConfig: initialChartConfig,\r\n\t\t\tplotData: initialPlotData,\r\n\t\t\txAccessor,\r\n\t\t\tdisplayXAccessor,\r\n\t\t} = this.state;\r\n\t\tconst { filterData } = this.state;\r\n\t\tconst { fullData } = this;\r\n\t\tconst { postCalculator } = this.props;\r\n\r\n\t\tconst { topLeft: iTL, bottomRight: iBR } = pinchCoordinates(initialPinch);\r\n\t\tconst { topLeft: fTL, bottomRight: fBR } = pinchCoordinates(finalPinch);\r\n\r\n\t\tconst e = initialPinchXScale.range()[1];\r\n\r\n\t\tconst xDash = Math.round(-(iBR[0] * fTL[0] - iTL[0] * fBR[0]) / (iTL[0] - iBR[0]));\r\n\t\tconst yDash = Math.round(e + ((e - iBR[0]) * (e - fTL[0]) - (e - iTL[0]) * (e - fBR[0])) / ((e - iTL[0]) - (e - iBR[0])));\r\n\r\n\t\tconst x = Math.round(-xDash * iTL[0] / (-xDash + fTL[0]));\r\n\t\tconst y = Math.round(e - (yDash - e) * (e - iTL[0]) / (yDash + (e - fTL[0])));\r\n\r\n\t\tconst newDomain = [x, y].map(initialPinchXScale.invert);\r\n\t\t// var domainR = initial.right + right;\r\n\r\n\t\tconst { plotData: beforePlotData, domain } = filterData(\r\n\t\t\tfullData,\r\n\t\t\tnewDomain,\r\n\t\t\txAccessor,\r\n\t\t\tinitialPinchXScale,\r\n\t\t\t{\r\n\t\t\t\tcurrentPlotData: initialPlotData,\r\n\t\t\t\tcurrentDomain: initialXScale.domain()\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tconst plotData = postCalculator(beforePlotData);\r\n\t\tconst updatedScale = initialXScale.copy().domain(domain);\r\n\r\n\t\tconst mouseXY = finalPinch.touch1Pos;\r\n\t\tconst chartConfig = getChartConfigWithUpdatedYScales(\r\n\t\t\tinitialChartConfig,\r\n\t\t\t{ plotData, xAccessor, displayXAccessor, fullData },\r\n\t\t\tupdatedScale.domain()\r\n\t\t);\r\n\t\tconst currentItem = getCurrentItem(updatedScale, xAccessor, mouseXY, plotData);\r\n\r\n\t\treturn {\r\n\t\t\tchartConfig,\r\n\t\t\txScale: updatedScale,\r\n\t\t\tplotData,\r\n\t\t\tmouseXY,\r\n\t\t\tcurrentItem,\r\n\t\t};\r\n\t}\r\n\tcancelDrag() {\r\n\t\tthis.eventCaptureNode.cancelDrag();\r\n\t\tthis.triggerEvent(\"dragcancel\");\r\n\t}\r\n\thandlePinchZoom(initialPinch, finalPinch, e) {\r\n\t\tif (!this.waitingForPinchZoomAnimationFrame) {\r\n\t\t\tthis.waitingForPinchZoomAnimationFrame = true;\r\n\t\t\tconst state = this.pinchZoomHelper(initialPinch, finalPinch);\r\n\r\n\t\t\tthis.triggerEvent(\"pinchzoom\", state, e);\r\n\r\n\t\t\tthis.finalPinch = finalPinch;\r\n\r\n\t\t\trequestAnimationFrame(() => {\r\n\t\t\t\tthis.clearBothCanvas();\r\n\t\t\t\tthis.draw({ trigger: \"pinchzoom\" });\r\n\t\t\t\tthis.waitingForPinchZoomAnimationFrame = false;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\thandlePinchZoomEnd(initialPinch, e) {\r\n\t\tconst { xAccessor } = this.state;\r\n\r\n\t\tif (this.finalPinch) {\r\n\t\t\tconst state = this.pinchZoomHelper(initialPinch, this.finalPinch);\r\n\t\t\tconst { xScale } = state;\r\n\t\t\tthis.triggerEvent(\"pinchzoom\", state, e);\r\n\r\n\t\t\tthis.finalPinch = null;\r\n\r\n\t\t\tthis.clearThreeCanvas();\r\n\r\n\t\t\tconst { fullData } = this;\r\n\t\t\tconst firstItem = head(fullData);\r\n\r\n\t\t\tconst start = head(xScale.domain());\r\n\t\t\tconst end = xAccessor(firstItem);\r\n\t\t\tconst { onLoadMore } = this.props;\r\n\r\n\t\t\tthis.setState(state, () => {\r\n\t\t\t\tif (start < end) {\r\n\t\t\t\t\tonLoadMore(start, end);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\thandleZoom(zoomDirection, mouseXY, e) {\r\n\t\tif (this.panInProgress)\r\n\t\t\treturn;\r\n\t\t// console.log(\"zoomDirection \", zoomDirection, \" mouseXY \", mouseXY);\r\n\t\tconst { xAccessor, xScale: initialXScale, plotData: initialPlotData } = this.state;\r\n\t\tconst { zoomMultiplier, zoomAnchor } = this.props;\r\n\t\tconst { fullData } = this;\r\n\t\tconst item = zoomAnchor({\r\n\t\t\txScale: initialXScale,\r\n\t\t\txAccessor,\r\n\t\t\tmouseXY,\r\n\t\t\tplotData: initialPlotData,\r\n\t\t\tfullData,\r\n\t\t});\r\n\r\n\t\tconst cx = initialXScale(item);\r\n\t\tconst c = zoomDirection > 0 ? 1 * zoomMultiplier : 1 / zoomMultiplier;\r\n\t\tconst newDomain = initialXScale.range().map(x => cx + (x - cx) * c).map(initialXScale.invert);\r\n\r\n\t\tconst { xScale, plotData, chartConfig } = this.calculateStateForDomain(newDomain);\r\n\r\n\t\tconst currentItem = getCurrentItem(xScale, xAccessor, mouseXY, plotData);\r\n\t\tconst currentCharts = getCurrentCharts(chartConfig, mouseXY);\r\n\r\n\t\tthis.clearThreeCanvas();\r\n\r\n\t\tconst firstItem = head(fullData);\r\n\r\n\t\tconst start = head(xScale.domain());\r\n\t\tconst end = xAccessor(firstItem);\r\n\t\tconst { onLoadMore } = this.props;\r\n\r\n\t\tthis.mutableState = {\r\n\t\t\tmouseXY: mouseXY,\r\n\t\t\tcurrentItem: currentItem,\r\n\t\t\tcurrentCharts: currentCharts,\r\n\t\t};\r\n\r\n\t\tthis.triggerEvent(\"zoom\", {\r\n\t\t\txScale,\r\n\t\t\tplotData,\r\n\t\t\tchartConfig,\r\n\t\t\tmouseXY,\r\n\t\t\tcurrentCharts,\r\n\t\t\tcurrentItem,\r\n\t\t\tshow: true,\r\n\t\t}, e);\r\n\r\n\t\tthis.setState({\r\n\t\t\txScale,\r\n\t\t\tplotData,\r\n\t\t\tchartConfig,\r\n\t\t}, () => {\r\n\t\t\tif (start < end) {\r\n\t\t\t\tonLoadMore(start, end);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\txAxisZoom(newDomain) {\r\n\t\tconst { xScale, plotData, chartConfig } = this.calculateStateForDomain(newDomain);\r\n\t\tthis.clearThreeCanvas();\r\n\r\n\t\tconst { xAccessor } = this.state;\r\n\t\tconst { fullData } = this;\r\n\t\tconst firstItem = head(fullData);\r\n\t\tconst start = head(xScale.domain());\r\n\t\tconst end = xAccessor(firstItem);\r\n\t\tconst { onLoadMore } = this.props;\r\n\r\n\t\tthis.setState({\r\n\t\t\txScale,\r\n\t\t\tplotData,\r\n\t\t\tchartConfig,\r\n\t\t}, () => {\r\n\t\t\tif (start < end) onLoadMore(start, end);\r\n\t\t});\r\n\t}\r\n\tyAxisZoom(chartId, newDomain) {\r\n\t\tthis.clearThreeCanvas();\r\n\t\tconst { chartConfig: initialChartConfig } = this.state;\r\n\t\tconst chartConfig = initialChartConfig\r\n\t\t\t.map(each => {\r\n\t\t\t\tif (each.id === chartId) {\r\n\t\t\t\t\tconst { yScale } = each;\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...each,\r\n\t\t\t\t\t\tyScale: yScale.copy().domain(newDomain),\r\n\t\t\t\t\t\tyPanEnabled: true,\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn each;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\tthis.setState({\r\n\t\t\tchartConfig,\r\n\t\t});\r\n\t}\r\n\ttriggerEvent(type, props, e) {\r\n\t\t// console.log(\"triggering ->\", type);\r\n\r\n\t\tthis.subscriptions.forEach(each => {\r\n\t\t\tconst state = {\r\n\t\t\t\t...this.state,\r\n\t\t\t\tfullData: this.fullData,\r\n\t\t\t\tsubscriptions: this.subscriptions,\r\n\t\t\t};\r\n\t\t\teach.listener(type, props, state, e);\r\n\t\t});\r\n\t}\r\n\tdraw(props) {\r\n\t\tthis.subscriptions.forEach(each => {\r\n\t\t\tif (isDefined(each.draw))\r\n\t\t\t\teach.draw(props);\r\n\t\t});\r\n\t}\r\n\tredraw() {\r\n\t\tthis.clearThreeCanvas();\r\n\t\tthis.draw({ force: true });\r\n\t}\r\n\tpanHelper(mouseXY, initialXScale, { dx, dy }, chartsToPan) {\r\n\t\tconst { xAccessor, displayXAccessor, chartConfig: initialChartConfig } = this.state;\r\n\t\tconst { filterData } = this.state;\r\n\t\tconst { fullData } = this;\r\n\t\tconst { postCalculator } = this.props;\r\n\r\n\t\t// console.log(dx, dy);\r\n\t\tif (isNotDefined(initialXScale.invert))\r\n\t\t\tthrow new Error(\"xScale provided does not have an invert() method.\"\r\n\t\t\t\t+ \"You are likely using an ordinal scale. This scale does not support zoom, pan\");\r\n\r\n\t\tconst newDomain = initialXScale.range().map(x => x - dx).map(initialXScale.invert);\r\n\r\n\t\tconst { plotData: beforePlotData, domain } = filterData(\r\n\t\t\tfullData,\r\n\t\t\tnewDomain,\r\n\t\t\txAccessor,\r\n\t\t\tinitialXScale,\r\n\t\t\t{\r\n\t\t\t\tcurrentPlotData: this.hackyWayToStopPanBeyondBounds__plotData,\r\n\t\t\t\tcurrentDomain: this.hackyWayToStopPanBeyondBounds__domain\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tconst updatedScale = initialXScale.copy().domain(domain);\r\n\t\tconst plotData = postCalculator(beforePlotData);\r\n\t\t// console.log(last(plotData));\r\n\r\n\t\tconst currentItem = getCurrentItem(updatedScale, xAccessor, mouseXY, plotData);\r\n\t\tconst chartConfig = getChartConfigWithUpdatedYScales(\r\n\t\t\tinitialChartConfig,\r\n\t\t\t{ plotData, xAccessor, displayXAccessor, fullData },\r\n\t\t\tupdatedScale.domain(),\r\n\t\t\tdy,\r\n\t\t\tchartsToPan\r\n\t\t);\r\n\t\tconst currentCharts = getCurrentCharts(chartConfig, mouseXY);\r\n\r\n\t\t// console.log(initialXScale.domain(), newDomain, updatedScale.domain());\r\n\t\treturn {\r\n\t\t\txScale: updatedScale,\r\n\t\t\tplotData,\r\n\t\t\tchartConfig,\r\n\t\t\tmouseXY,\r\n\t\t\tcurrentCharts,\r\n\t\t\tcurrentItem,\r\n\t\t};\r\n\t}\r\n\thandlePan(mousePosition, panStartXScale, dxdy, chartsToPan, e) {\r\n\t\tif (!this.waitingForPanAnimationFrame) {\r\n\t\t\tthis.waitingForPanAnimationFrame = true;\r\n\r\n\t\t\tthis.hackyWayToStopPanBeyondBounds__plotData = this.hackyWayToStopPanBeyondBounds__plotData || this.state.plotData;\r\n\t\t\tthis.hackyWayToStopPanBeyondBounds__domain = this.hackyWayToStopPanBeyondBounds__domain || this.state.xScale.domain();\r\n\r\n\t\t\tconst state = this.panHelper(mousePosition, panStartXScale, dxdy, chartsToPan);\r\n\r\n\t\t\tthis.hackyWayToStopPanBeyondBounds__plotData = state.plotData;\r\n\t\t\tthis.hackyWayToStopPanBeyondBounds__domain = state.xScale.domain();\r\n\r\n\t\t\tthis.panInProgress = true;\r\n\t\t\t// console.log(panStartXScale.domain(), state.xScale.domain());\r\n\r\n\t\t\tthis.triggerEvent(\"pan\", state, e);\r\n\r\n\t\t\tthis.mutableState = {\r\n\t\t\t\tmouseXY: state.mouseXY,\r\n\t\t\t\tcurrentItem: state.currentItem,\r\n\t\t\t\tcurrentCharts: state.currentCharts,\r\n\t\t\t};\r\n\t\t\trequestAnimationFrame(() => {\r\n\t\t\t\tthis.waitingForPanAnimationFrame = false;\r\n\t\t\t\tthis.clearBothCanvas();\r\n\t\t\t\tthis.draw({ trigger: \"pan\" });\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\thandlePanEnd(mousePosition, panStartXScale, dxdy, chartsToPan, e) {\r\n\t\tconst state = this.panHelper(mousePosition, panStartXScale, dxdy, chartsToPan);\r\n\t\t// console.log(this.canvasDrawCallbackList.map(d => d.type));\r\n\t\tthis.hackyWayToStopPanBeyondBounds__plotData = null;\r\n\t\tthis.hackyWayToStopPanBeyondBounds__domain = null;\r\n\r\n\t\tthis.panInProgress = false;\r\n\r\n\t\t// console.log(\"PANEND\", panEnd++);\r\n\t\tconst {\r\n\t\t\txScale,\r\n\t\t\tplotData,\r\n\t\t\tchartConfig,\r\n\t\t} = state;\r\n\r\n\t\tthis.triggerEvent(\"panend\", state, e);\r\n\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tconst { xAccessor } = this.state;\r\n\t\t\tconst { fullData } = this;\r\n\r\n\t\t\tconst firstItem = head(fullData);\r\n\t\t\tconst start = head(xScale.domain());\r\n\t\t\tconst end = xAccessor(firstItem);\r\n\t\t\t// console.log(start, end, start < end ? \"Load more\" : \"I have it\");\r\n\r\n\t\t\tconst { onLoadMore } = this.props;\r\n\r\n\t\t\tthis.clearThreeCanvas();\r\n\r\n\t\t\tthis.setState({\r\n\t\t\t\txScale,\r\n\t\t\t\tplotData,\r\n\t\t\t\tchartConfig,\r\n\t\t\t}, () => {\r\n\t\t\t\tif (start < end) onLoadMore(start, end);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\thandleMouseDown(mousePosition, currentCharts, e) {\r\n\t\tthis.triggerEvent(\"mousedown\", this.mutableState, e);\r\n\t}\r\n\thandleMouseEnter(e) {\r\n\t\tthis.triggerEvent(\"mouseenter\", {\r\n\t\t\tshow: true,\r\n\t\t}, e);\r\n\t}\r\n\thandleMouseMove(mouseXY, inputType, e) {\r\n\t\tif (!this.waitingForMouseMoveAnimationFrame) {\r\n\t\t\tthis.waitingForMouseMoveAnimationFrame = true;\r\n\r\n\t\t\tconst { chartConfig, plotData, xScale, xAccessor } = this.state;\r\n\t\t\tconst currentCharts = getCurrentCharts(chartConfig, mouseXY);\r\n\t\t\tconst currentItem = getCurrentItem(xScale, xAccessor, mouseXY, plotData);\r\n\t\t\tthis.triggerEvent(\"mousemove\", {\r\n\t\t\t\tshow: true,\r\n\t\t\t\tmouseXY,\r\n\t\t\t\t// prevMouseXY is used in interactive components\r\n\t\t\t\tprevMouseXY: this.prevMouseXY,\r\n\t\t\t\tcurrentItem,\r\n\t\t\t\tcurrentCharts,\r\n\t\t\t}, e);\r\n\r\n\t\t\tthis.prevMouseXY = mouseXY;\r\n\t\t\tthis.mutableState = {\r\n\t\t\t\tmouseXY,\r\n\t\t\t\tcurrentItem,\r\n\t\t\t\tcurrentCharts,\r\n\t\t\t};\r\n\r\n\t\t\trequestAnimationFrame(() => {\r\n\t\t\t\tthis.clearMouseCanvas();\r\n\t\t\t\tthis.draw({ trigger: \"mousemove\" });\r\n\t\t\t\tthis.waitingForMouseMoveAnimationFrame = false;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\thandleMouseLeave(e) {\r\n\t\tthis.triggerEvent(\"mouseleave\", { show: false }, e);\r\n\t\tthis.clearMouseCanvas();\r\n\t\tthis.draw({ trigger: \"mouseleave\" });\r\n\t}\r\n\thandleDragStart({ startPos }, e) {\r\n\t\tthis.triggerEvent(\"dragstart\", { startPos }, e);\r\n\t}\r\n\thandleDrag({ startPos, mouseXY }, e) {\r\n\t\tconst { chartConfig, plotData, xScale, xAccessor } = this.state;\r\n\t\tconst currentCharts = getCurrentCharts(chartConfig, mouseXY);\r\n\t\tconst currentItem = getCurrentItem(xScale, xAccessor, mouseXY, plotData);\r\n\r\n\t\tthis.triggerEvent(\"drag\", {\r\n\t\t\tstartPos,\r\n\t\t\tmouseXY,\r\n\t\t\tcurrentItem,\r\n\t\t\tcurrentCharts,\r\n\t\t}, e);\r\n\r\n\t\tthis.mutableState = {\r\n\t\t\tmouseXY,\r\n\t\t\tcurrentItem,\r\n\t\t\tcurrentCharts,\r\n\t\t};\r\n\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tthis.clearMouseCanvas();\r\n\t\t\tthis.draw({ trigger: \"drag\" });\r\n\t\t});\r\n\t}\r\n\thandleDragEnd({ mouseXY }, e) {\r\n\t\tthis.triggerEvent(\"dragend\", { mouseXY }, e);\r\n\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tthis.clearMouseCanvas();\r\n\t\t\tthis.draw({ trigger: \"dragend\" });\r\n\t\t});\r\n\t}\r\n\thandleClick(mousePosition, e) {\r\n\t\tthis.triggerEvent(\"click\", this.mutableState, e);\r\n\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tthis.clearMouseCanvas();\r\n\t\t\tthis.draw({ trigger: \"click\" });\r\n\t\t});\r\n\t}\r\n\thandleDoubleClick(mousePosition, e) {\r\n\t\tthis.triggerEvent(\"dblclick\", {}, e);\r\n\t}\r\n\tgetChildContext() {\r\n\t\tconst dimensions = getDimensions(this.props);\r\n\t\treturn {\r\n\t\t\tfullData: this.fullData,\r\n\t\t\tplotData: this.state.plotData,\r\n\t\t\twidth: dimensions.width,\r\n\t\t\theight: dimensions.height,\r\n\t\t\tchartConfig: this.state.chartConfig,\r\n\t\t\txScale: this.state.xScale,\r\n\t\t\txAccessor: this.state.xAccessor,\r\n\t\t\tdisplayXAccessor: this.state.displayXAccessor,\r\n\t\t\tchartCanvasType: this.props.type,\r\n\t\t\tmargin: this.props.margin,\r\n\t\t\tratio: this.props.ratio,\r\n\t\t\txAxisZoom: this.xAxisZoom,\r\n\t\t\tyAxisZoom: this.yAxisZoom,\r\n\t\t\tgetCanvasContexts: this.getCanvasContexts,\r\n\t\t\tredraw: this.redraw,\r\n\t\t\tsubscribe: this.subscribe,\r\n\t\t\tunsubscribe: this.unsubscribe,\r\n\t\t\tgenerateSubscriptionId: this.generateSubscriptionId,\r\n\t\t\tgetMutableState: this.getMutableState,\r\n\t\t\tamIOnTop: this.amIOnTop,\r\n\t\t\tsetCursorClass: this.setCursorClass,\r\n\t\t};\r\n\t}\r\n\tcomponentWillMount() {\r\n\t\tconst { fullData, ...state } = resetChart(this.props, true);\r\n\t\tthis.setState(state);\r\n\t\tthis.fullData = fullData;\r\n\t}\r\n\tcomponentWillReceiveProps(nextProps) {\r\n\t\tconst reset = shouldResetChart(this.props, nextProps);\r\n\r\n\t\tconst interaction = isInteractionEnabled(this.state.xScale, this.state.xAccessor, this.state.plotData);\r\n\t\tconst { chartConfig: initialChartConfig } = this.state;\r\n\r\n\t\tlet newState;\r\n\t\tif (!interaction || reset || !shallowEqual(this.props.xExtents, nextProps.xExtents)) {\r\n\t\t\tif (process.env.NODE_ENV !== \"production\") {\r\n\t\t\t\tif (!interaction)\r\n\t\t\t\t\tlog(\"RESET CHART, changes to a non interactive chart\");\r\n\t\t\t\telse if (reset)\r\n\t\t\t\t\tlog(\"RESET CHART, one or more of these props changed\", CANDIDATES_FOR_RESET);\r\n\t\t\t\telse\r\n\t\t\t\t\tlog(\"xExtents changed\");\r\n\t\t\t}\r\n\t\t\t// do reset\r\n\t\t\tnewState = resetChart(nextProps);\r\n\t\t\tthis.mutableState = {};\r\n\t\t} else {\r\n\r\n\t\t\tconst [start, end] = this.state.xScale.domain();\r\n\t\t\tconst prevLastItem = last(this.fullData);\r\n\r\n\t\t\tconst calculatedState = calculateFullData(nextProps);\r\n\t\t\tconst { xAccessor } = calculatedState;\r\n\t\t\tconst lastItemWasVisible = xAccessor(prevLastItem) <= end && xAccessor(prevLastItem) >= start;\r\n\r\n\t\t\tif (process.env.NODE_ENV !== \"production\") {\r\n\t\t\t\tif (this.props.data !== nextProps.data)\r\n\t\t\t\t\tlog(\"data is changed but seriesName did not, change the seriesName if you wish to reset the chart and lastItemWasVisible = \", lastItemWasVisible);\r\n\t\t\t\telse\r\n\t\t\t\t\tlog(\"Trivial change, may be width/height or type changed, but that does not matter\");\r\n\t\t\t}\r\n\r\n\t\t\tnewState = updateChart(\r\n\t\t\t\tcalculatedState,\r\n\t\t\t\tthis.state.xScale,\r\n\t\t\t\tnextProps,\r\n\t\t\t\tlastItemWasVisible,\r\n\t\t\t\tinitialChartConfig,\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tconst { fullData, ...state } = newState;\r\n\r\n\t\tif (this.panInProgress) {\r\n\t\t\tif (process.env.NODE_ENV !== \"production\") {\r\n\t\t\t\tlog(\"Pan is in progress\");\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t/*\r\n\t\t\tif (!reset) {\r\n\t\t\t\tstate.chartConfig\r\n\t\t\t\t\t.forEach((each) => {\r\n\t\t\t\t\t\t// const sourceChartConfig = initialChartConfig.filter(d => d.id === each.id);\r\n\t\t\t\t\t\tconst prevChartConfig = find(initialChartConfig, d => d.id === each.id);\r\n\t\t\t\t\t\tif (isDefined(prevChartConfig) && prevChartConfig.yPanEnabled) {\r\n\t\t\t\t\t\t\teach.yScale.domain(prevChartConfig.yScale.domain());\r\n\t\t\t\t\t\t\teach.yPanEnabled = prevChartConfig.yPanEnabled;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t\tthis.clearThreeCanvas();\r\n\r\n\t\t\tthis.setState(state);\r\n\t\t}\r\n\t\tthis.fullData = fullData;\r\n\t}\r\n\t/*\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tconsole.error(this.state.chartConfig, this.state.chartConfig.map(d => d.yScale.domain()));\r\n\t}\r\n\t*/\r\n\tresetYDomain(chartId) {\r\n\t\tconst { chartConfig } = this.state;\r\n\t\tlet changed = false;\r\n\t\tconst newChartConfig = chartConfig\r\n\t\t\t.map(each => {\r\n\t\t\t\tif ((isNotDefined(chartId) || each.id === chartId)\r\n\t\t\t\t\t\t&& !shallowEqual(each.yScale.domain(), each.realYDomain)) {\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...each,\r\n\t\t\t\t\t\tyScale: each.yScale.domain(each.realYDomain),\r\n\t\t\t\t\t\tyPanEnabled: false,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\treturn each;\r\n\t\t\t});\r\n\r\n\t\tif (changed) {\r\n\t\t\tthis.clearThreeCanvas();\r\n\t\t\tthis.setState({\r\n\t\t\t\tchartConfig: newChartConfig\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tshouldComponentUpdate() {\r\n\t\t// console.log(\"Happneing.....\", !this.panInProgress)\r\n\t\treturn !this.panInProgress;\r\n\t}\r\n\trender() {\r\n\r\n\t\tconst { type, height, width, margin, className, zIndex, defaultFocus, ratio, mouseMoveEvent, panEvent, zoomEvent } = this.props;\r\n\t\tconst { useCrossHairStyleCursor, onSelect } = this.props;\r\n\r\n\t\tconst { plotData, xScale, xAccessor, chartConfig } = this.state;\r\n\t\tconst dimensions = getDimensions(this.props);\r\n\r\n\t\tconst interaction = isInteractionEnabled(xScale, xAccessor, plotData);\r\n\r\n\t\tconst cursorStyle = useCrossHairStyleCursor && interaction;\r\n\t\tconst cursor = getCursorStyle();\r\n\t\treturn (\r\n\t\t\t<div style={{ position: \"relative\", width, height }} className={className} onClick={onSelect}>\r\n\t\t\t\t<CanvasContainer ref={this.saveCanvasContainerNode}\r\n\t\t\t\t\ttype={type}\r\n\t\t\t\t\tratio={ratio}\r\n\t\t\t\t\twidth={width} height={height} zIndex={zIndex}/>\r\n\t\t\t\t<svg className={className} width={width} height={height} style={{ position: \"absolute\", zIndex: (zIndex + 5) }}>\r\n\t\t\t\t\t{cursor}\r\n\t\t\t\t\t<defs>\r\n\t\t\t\t\t\t<clipPath id=\"chart-area-clip\">\r\n\t\t\t\t\t\t\t<rect x=\"0\" y=\"0\" width={dimensions.width} height={dimensions.height} />\r\n\t\t\t\t\t\t</clipPath>\r\n\t\t\t\t\t\t{chartConfig\r\n\t\t\t\t\t\t\t.map((each, idx) => <clipPath key={idx} id={`chart-area-clip-${each.id}`}>\r\n\t\t\t\t\t\t\t\t<rect x=\"0\" y=\"0\" width={each.width} height={each.height} />\r\n\t\t\t\t\t\t\t</clipPath>)}\r\n\t\t\t\t\t</defs>\r\n\t\t\t\t\t<g transform={`translate(${margin.left + 0.5}, ${margin.top + 0.5})`}>\r\n\t\t\t\t\t\t<EventCapture\r\n\t\t\t\t\t\t\tref={this.saveEventCaptureNode}\r\n\t\t\t\t\t\t\tuseCrossHairStyleCursor={cursorStyle}\r\n\t\t\t\t\t\t\tmouseMove={mouseMoveEvent && interaction}\r\n\t\t\t\t\t\t\tzoom={zoomEvent && interaction}\r\n\t\t\t\t\t\t\tpan={panEvent && interaction}\r\n\r\n\t\t\t\t\t\t\twidth={dimensions.width}\r\n\t\t\t\t\t\t\theight={dimensions.height}\r\n\t\t\t\t\t\t\tchartConfig={chartConfig}\r\n\t\t\t\t\t\t\txScale={xScale}\r\n\t\t\t\t\t\t\txAccessor={xAccessor}\r\n\t\t\t\t\t\t\tfocus={defaultFocus}\r\n\t\t\t\t\t\t\tdisableInteraction={this.props.disableInteraction}\r\n\r\n\t\t\t\t\t\t\tgetAllPanConditions={this.getAllPanConditions}\r\n\t\t\t\t\t\t\tonContextMenu={this.handleContextMenu}\r\n\t\t\t\t\t\t\tonClick={this.handleClick}\r\n\t\t\t\t\t\t\tonDoubleClick={this.handleDoubleClick}\r\n\t\t\t\t\t\t\tonMouseDown={this.handleMouseDown}\r\n\t\t\t\t\t\t\tonMouseMove={this.handleMouseMove}\r\n\t\t\t\t\t\t\tonMouseEnter={this.handleMouseEnter}\r\n\t\t\t\t\t\t\tonMouseLeave={this.handleMouseLeave}\r\n\r\n\t\t\t\t\t\t\tonDragStart={this.handleDragStart}\r\n\t\t\t\t\t\t\tonDrag={this.handleDrag}\r\n\t\t\t\t\t\t\tonDragComplete={this.handleDragEnd}\r\n\r\n\t\t\t\t\t\t\tonZoom={this.handleZoom}\r\n\t\t\t\t\t\t\tonPinchZoom={this.handlePinchZoom}\r\n\t\t\t\t\t\t\tonPinchZoomEnd={this.handlePinchZoomEnd}\r\n\t\t\t\t\t\t\tonPan={this.handlePan}\r\n\t\t\t\t\t\t\tonPanEnd={this.handlePanEnd}\r\n\t\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t\t<g className=\"react-stockcharts-avoid-interaction\">\r\n\t\t\t\t\t\t\t{this.props.children}\r\n\t\t\t\t\t\t</g>\r\n\t\t\t\t\t</g>\r\n\t\t\t\t</svg>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nfunction isInteractionEnabled(xScale, xAccessor, data) {\r\n\tconst interaction = !isNaN(xScale(xAccessor(head(data)))) && isDefined(xScale.invert);\r\n\treturn interaction;\r\n}\r\n\r\nChartCanvas.propTypes = {\r\n\twidth: PropTypes.number.isRequired,\r\n\theight: PropTypes.number.isRequired,\r\n\tmargin: PropTypes.object,\r\n\tratio: PropTypes.number.isRequired,\r\n\t// interval: PropTypes.oneOf([\"D\", \"W\", \"M\"]), // ,\"m1\", \"m5\", \"m15\", \"W\", \"M\"\r\n\ttype: PropTypes.oneOf([\"svg\", \"hybrid\"]),\r\n\tpointsPerPxThreshold: PropTypes.number,\r\n\tminPointsPerPxThreshold: PropTypes.number,\r\n\tdata: PropTypes.array.isRequired,\r\n\t// initialDisplay: PropTypes.number,\r\n\txAccessor: PropTypes.func,\r\n\txExtents: PropTypes.oneOfType([\r\n\t\tPropTypes.array,\r\n\t\tPropTypes.func\r\n\t]),\r\n\tzoomAnchor: PropTypes.func,\r\n\r\n\tclassName: PropTypes.string,\r\n\tseriesName: PropTypes.string.isRequired,\r\n\tzIndex: PropTypes.number,\r\n\tchildren: PropTypes.node.isRequired,\r\n\txScale: PropTypes.func.isRequired,\r\n\tpostCalculator: PropTypes.func,\r\n\tflipXScale: PropTypes.bool,\r\n\tuseCrossHairStyleCursor: PropTypes.bool,\r\n\tpadding: PropTypes.oneOfType([\r\n\t\tPropTypes.number,\r\n\t\tPropTypes.shape({\r\n\t\t\tleft: PropTypes.number,\r\n\t\t\tright: PropTypes.number,\r\n\t\t})\r\n\t]),\r\n\tdefaultFocus: PropTypes.bool,\r\n\tzoomMultiplier: PropTypes.number,\r\n\tonLoadMore: PropTypes.func,\r\n\tdisplayXAccessor: function(props, propName/* , componentName */) {\r\n\t\tif (isNotDefined(props[propName])) {\r\n\t\t\tconsole.warn(\"`displayXAccessor` is not defined,\"\r\n\t\t\t\t+ \" will use the value from `xAccessor` as `displayXAccessor`.\"\r\n\t\t\t\t+ \" This might be ok if you do not use a discontinuous scale\"\r\n\t\t\t\t+ \" but if you do, provide a `displayXAccessor` prop to `ChartCanvas`\");\r\n\t\t} else if (typeof props[propName] !== \"function\") {\r\n\t\t\treturn new Error(\"displayXAccessor has to be a function\");\r\n\t\t}\r\n\t},\r\n\tmouseMoveEvent: PropTypes.bool,\r\n\tpanEvent: PropTypes.bool,\r\n\tclamp: PropTypes.oneOfType([PropTypes.string, PropTypes.bool, PropTypes.func]),\r\n\tzoomEvent: PropTypes.bool,\r\n\tonSelect: PropTypes.func,\r\n\tmaintainPointsPerPixelOnResize: PropTypes.bool,\r\n\tdisableInteraction: PropTypes.bool,\r\n};\r\n\r\nChartCanvas.defaultProps = {\r\n\tmargin: { top: 20, right: 30, bottom: 30, left: 80 },\r\n\ttype: \"hybrid\",\r\n\tpointsPerPxThreshold: 2,\r\n\tminPointsPerPxThreshold: 1 / 100,\r\n\tclassName: \"react-stockchart\",\r\n\tzIndex: 1,\r\n\txExtents: [min, max],\r\n\tpostCalculator: identity,\r\n\tpadding: 0,\r\n\txAccessor: identity,\r\n\tflipXScale: false,\r\n\tuseCrossHairStyleCursor: true,\r\n\tdefaultFocus: true,\r\n\tonLoadMore: noop,\r\n\tonSelect: noop,\r\n\tmouseMoveEvent: true,\r\n\tpanEvent: true,\r\n\tzoomEvent: true,\r\n\tzoomMultiplier: 1.1,\r\n\tclamp: false,\r\n\tzoomAnchor: mouseBasedZoomAnchor,\r\n\tmaintainPointsPerPixelOnResize: true,\r\n\t// ratio: 2,\r\n\tdisableInteraction: false,\r\n};\r\n\r\nChartCanvas.childContextTypes = {\r\n\tplotData: PropTypes.array,\r\n\tfullData: PropTypes.array,\r\n\tchartConfig: PropTypes.arrayOf(\r\n\t\tPropTypes.shape({\r\n\t\t\tid: PropTypes.oneOfType([PropTypes.number, PropTypes.string]).isRequired,\r\n\t\t\torigin: PropTypes.arrayOf(PropTypes.number).isRequired,\r\n\t\t\tpadding: PropTypes.oneOfType([\r\n\t\t\t\tPropTypes.number,\r\n\t\t\t\tPropTypes.shape({\r\n\t\t\t\t\ttop: PropTypes.number,\r\n\t\t\t\t\tbottom: PropTypes.number,\r\n\t\t\t\t})\r\n\t\t\t]),\r\n\t\t\tyExtents: PropTypes.arrayOf(PropTypes.func),\r\n\t\t\tyExtentsProvider: PropTypes.func,\r\n\t\t\tyScale: PropTypes.func.isRequired,\r\n\t\t\tmouseCoordinates: PropTypes.shape({\r\n\t\t\t\tat: PropTypes.string,\r\n\t\t\t\tformat: PropTypes.func\r\n\t\t\t}),\r\n\t\t\twidth: PropTypes.number.isRequired,\r\n\t\t\theight: PropTypes.number.isRequired,\r\n\t\t})\r\n\t).isRequired,\r\n\txScale: PropTypes.func.isRequired,\r\n\txAccessor: PropTypes.func.isRequired,\r\n\tdisplayXAccessor: PropTypes.func.isRequired,\r\n\twidth: PropTypes.number.isRequired,\r\n\theight: PropTypes.number.isRequired,\r\n\tchartCanvasType: PropTypes.oneOf([\"svg\", \"hybrid\"]).isRequired,\r\n\tmargin: PropTypes.object.isRequired,\r\n\tratio: PropTypes.number.isRequired,\r\n\tgetCanvasContexts: PropTypes.func,\r\n\txAxisZoom: PropTypes.func,\r\n\tyAxisZoom: PropTypes.func,\r\n\tamIOnTop: PropTypes.func,\r\n\tredraw: PropTypes.func,\r\n\tsubscribe: PropTypes.func,\r\n\tunsubscribe: PropTypes.func,\r\n\tsetCursorClass: PropTypes.func,\r\n\tgenerateSubscriptionId: PropTypes.func,\r\n\tgetMutableState: PropTypes.func,\r\n};\r\n\r\nChartCanvas.ohlcv = d => ({ date: d.date, open: d.open, high: d.high, low: d.low, close: d.close, volume: d.volume });\r\n\r\nexport default ChartCanvas;\r\n"]}