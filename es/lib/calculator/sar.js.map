{"version":3,"sources":["../../../../src/lib/calculator/sar.js"],"names":["mappedSlidingWindow","isNotDefined","isDefined","SAR","defaultOptions","calc","prev","now","risingSar","af","risingEp","fallingSar","fallingEp","Math","max","high","min","low","options","calculator","data","accelerationFactor","maxAccelerationFactor","algorithm","windowSize","undefinedValue","accumulator","use","current","date","sar","calculatedData","map","d","undefinedLength","x","arguments","length"],"mappings":";;;;AAEA,SAASA,mBAAT,EAA8BC,YAA9B,EAA4CC,SAA5C,QAA6D,UAA7D;AACA,SAASC,OAAOC,cAAhB,QAAsC,gCAAtC;;AAEA,SAASC,IAAT,CAAcC,IAAd,EAAoBC,GAApB,EAAyB;AACxB,KAAMC,YAAYF,KAAKE,SAAL,GACfF,KAAKG,EAAL,IAAWH,KAAKI,QAAL,GAAgBJ,KAAKE,SAAhC,CADH;;AAGA,KAAMG,aAAaL,KAAKK,UAAL,GAChBL,KAAKG,EAAL,IAAWH,KAAKK,UAAL,GAAkBL,KAAKM,SAAlC,CADH;;AAGA,KAAMF,WAAWG,KAAKC,GAAL,CAASR,KAAKI,QAAd,EAAwBH,IAAIQ,IAA5B,CAAjB;AACA,KAAMH,YAAYC,KAAKG,GAAL,CAASV,KAAKM,SAAd,EAAyBL,IAAIU,GAA7B,CAAlB;;AAEA,QAAO;AACNT,sBADM;AAENG,wBAFM;AAGND,oBAHM;AAINE;AAJM,EAAP;AAMA;;AAED,eAAe,YAAW;;AAEzB,KAAIM,UAAUd,cAAd;;AAEA,UAASe,UAAT,CAAoBC,IAApB,EAA0B;AAAA,iBAC6BF,OAD7B;AAAA,MACjBG,kBADiB,YACjBA,kBADiB;AAAA,MACGC,qBADH,YACGA,qBADH;;;AAGzB,MAAMC,YAAYvB,sBAChBwB,UADgB,CACL,CADK,EAEhBC,cAFgB,CAED,gBAAmB;AAAA,OAAhBV,IAAgB,QAAhBA,IAAgB;AAAA,OAAVE,GAAU,QAAVA,GAAU;;AAClC,UAAO;AACNT,eAAWS,GADL;AAENP,cAAUK,IAFJ;AAGNJ,gBAAYI,IAHN;AAINH,eAAWK,GAJL;AAKNR,QAAIY;AALE,IAAP;AAOA,GAVgB,EAWhBK,WAXgB,CAWJ,iBAAiB;AAAA;AAAA,OAAfpB,IAAe;AAAA,OAATC,GAAS;;AAAA,eAOzBF,KAAKC,IAAL,EAAWC,GAAX,CAPyB;AAAA,OAG5BC,SAH4B,SAG5BA,SAH4B;AAAA,OAI5BG,UAJ4B,SAI5BA,UAJ4B;AAAA,OAK5BD,QAL4B,SAK5BA,QAL4B;AAAA,OAM5BE,SAN4B,SAM5BA,SAN4B;;AAS7B,OAAIX,aAAaK,KAAKqB,GAAlB,KACCnB,YAAYD,IAAIU,GADjB,IAECN,aAAaJ,IAAIQ,IAFtB,EAE4B;AAC3B,WAAO;AACNP,yBADM;AAENG,2BAFM;AAGND,uBAHM;AAINE;AAJM,KAAP;AAMA;;AAED,OAAMe,MAAMzB,UAAUI,KAAKqB,GAAf,IACTrB,KAAKqB,GAAL,KAAa,QAAb,GACCnB,YAAYD,IAAIU,GAAhB,GAAsB,SAAtB,GAAkC,QADnC,GAECN,aAAaJ,IAAIQ,IAAjB,GAAwB,QAAxB,GAAmC,SAH3B,GAITP,YAAYD,IAAIU,GAAhB,GACC,SADD,GAEC,QANJ;;AAQA,OAAMW,UAAUtB,KAAKqB,GAAL,KAAaA,GAAb,GACb;AACDlB,QAAII,KAAKG,GAAL,CAASM,qBAAT,EAAgChB,KAAKG,EAAL,GAAUY,kBAA1C,CADH;AAEDT,wBAFC;AAGDF,sBAHC;AAIDC,0BAJC;AAKDH;AALC,IADa,GAQb;AACDC,QAAIY,kBADH;AAEDT,eAAWL,IAAIU,GAFd;AAGDP,cAAUH,IAAIQ,IAHb;AAIDJ,gBAAYE,KAAKC,GAAL,CAASR,KAAKI,QAAd,EAAwBH,IAAIQ,IAA5B,CAJX;AAKDP,eAAWK,KAAKG,GAAL,CAASV,KAAKM,SAAd,EAAyBL,IAAIU,GAA7B;AALV,IARH;;AA5B6B,OA4CrBY,IA5CqB,GA4CDtB,GA5CC,CA4CrBsB,IA5CqB;AAAA,OA4Cfd,IA5Ce,GA4CDR,GA5CC,CA4CfQ,IA5Ce;AAAA,OA4CTE,GA5CS,GA4CDV,GA5CC,CA4CTU,GA5CS;;AA6C7B;AACCY,cADD;AAECd,cAFD;AAGCE;AAHD,MAIIW,OAJJ;AAKCD,YALD;AAMCG,SAAKH,QAAQ,SAAR,GAAoBC,QAAQjB,UAA5B,GAAyCiB,QAAQpB;AANvD;AAQA,GAhEgB,CAAlB;;AAkEA,MAAMuB,iBAAiBR,UAAUH,IAAV,EAAgBY,GAAhB,CAAoB;AAAA,UAAKC,EAAEH,GAAP;AAAA,GAApB,CAAvB;AACA;;AAEA,SAAOC,cAAP;AACA;AACDZ,YAAWe,eAAX,GAA6B,YAAW;AACvC,SAAO,CAAP;AACA,EAFD;AAGAf,YAAWD,OAAX,GAAqB,UAASiB,CAAT,EAAY;AAChC,MAAI,CAACC,UAAUC,MAAf,EAAuB;AACtB,UAAOnB,OAAP;AACA;AACDA,yBAAed,cAAf,EAAkC+B,CAAlC;AACA,SAAOhB,UAAP;AACA,EAND;;AAQA,QAAOA,UAAP;AACA","file":"sar.js","sourcesContent":["\r\n\r\nimport { mappedSlidingWindow, isNotDefined, isDefined } from \"../utils\";\r\nimport { SAR as defaultOptions } from \"./defaultOptionsForComputation\";\r\n\r\nfunction calc(prev, now) {\r\n\tconst risingSar = prev.risingSar\r\n\t\t+ prev.af * (prev.risingEp - prev.risingSar);\r\n\r\n\tconst fallingSar = prev.fallingSar\r\n\t\t- prev.af * (prev.fallingSar - prev.fallingEp);\r\n\r\n\tconst risingEp = Math.max(prev.risingEp, now.high);\r\n\tconst fallingEp = Math.min(prev.fallingEp, now.low);\r\n\r\n\treturn {\r\n\t\trisingSar,\r\n\t\tfallingSar,\r\n\t\trisingEp,\r\n\t\tfallingEp,\r\n\t};\r\n}\r\n\r\nexport default function() {\r\n\r\n\tlet options = defaultOptions;\r\n\r\n\tfunction calculator(data) {\r\n\t\tconst { accelerationFactor, maxAccelerationFactor } = options;\r\n\r\n\t\tconst algorithm = mappedSlidingWindow()\r\n\t\t\t.windowSize(2)\r\n\t\t\t.undefinedValue(({ high, low }) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\trisingSar: low,\r\n\t\t\t\t\trisingEp: high,\r\n\t\t\t\t\tfallingSar: high,\r\n\t\t\t\t\tfallingEp: low,\r\n\t\t\t\t\taf: accelerationFactor,\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.accumulator(([prev, now]) => {\r\n\r\n\t\t\t\tconst {\r\n\t\t\t\t\trisingSar,\r\n\t\t\t\t\tfallingSar,\r\n\t\t\t\t\trisingEp,\r\n\t\t\t\t\tfallingEp,\r\n\t\t\t\t} = calc(prev, now);\r\n\r\n\t\t\t\tif (isNotDefined(prev.use)\r\n\t\t\t\t\t\t&& risingSar > now.low\r\n\t\t\t\t\t\t&& fallingSar < now.high) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\trisingSar,\r\n\t\t\t\t\t\tfallingSar,\r\n\t\t\t\t\t\trisingEp,\r\n\t\t\t\t\t\tfallingEp,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst use = isDefined(prev.use)\r\n\t\t\t\t\t? prev.use === \"rising\"\r\n\t\t\t\t\t\t? risingSar > now.low ? \"falling\" : \"rising\"\r\n\t\t\t\t\t\t: fallingSar < now.high ? \"rising\" : \"falling\"\r\n\t\t\t\t\t: risingSar > now.low\r\n\t\t\t\t\t\t? \"falling\"\r\n\t\t\t\t\t\t: \"rising\";\r\n\r\n\t\t\t\tconst current = prev.use === use\r\n\t\t\t\t\t? {\r\n\t\t\t\t\t\taf: Math.min(maxAccelerationFactor, prev.af + accelerationFactor),\r\n\t\t\t\t\t\tfallingEp,\r\n\t\t\t\t\t\trisingEp,\r\n\t\t\t\t\t\tfallingSar,\r\n\t\t\t\t\t\trisingSar,\r\n\t\t\t\t\t}\r\n\t\t\t\t\t: {\r\n\t\t\t\t\t\taf: accelerationFactor,\r\n\t\t\t\t\t\tfallingEp: now.low,\r\n\t\t\t\t\t\trisingEp: now.high,\r\n\t\t\t\t\t\tfallingSar: Math.max(prev.risingEp, now.high),\r\n\t\t\t\t\t\trisingSar: Math.min(prev.fallingEp, now.low),\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\tconst { date, high, low } = now;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdate,\r\n\t\t\t\t\thigh,\r\n\t\t\t\t\tlow,\r\n\t\t\t\t\t...current,\r\n\t\t\t\t\tuse,\r\n\t\t\t\t\tsar: use === \"falling\" ? current.fallingSar : current.risingSar,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\tconst calculatedData = algorithm(data).map(d => d.sar);\r\n\t\t// console.log(calculatedData);\r\n\r\n\t\treturn calculatedData;\r\n\t}\r\n\tcalculator.undefinedLength = function() {\r\n\t\treturn 1;\r\n\t};\r\n\tcalculator.options = function(x) {\r\n\t\tif (!arguments.length) {\r\n\t\t\treturn options;\r\n\t\t}\r\n\t\toptions = { ...defaultOptions, ...x };\r\n\t\treturn calculator;\r\n\t};\r\n\r\n\treturn calculator;\r\n}\r\n"]}