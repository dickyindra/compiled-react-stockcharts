{"version":3,"sources":["../../../../src/lib/coordinates/CrossHairCursor.js"],"names":["React","Component","PropTypes","GenericComponent","getMouseCanvas","hexToRGBA","isDefined","isNotDefined","strokeDashTypes","getStrokeDasharray","CrossHairCursor","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","lines","helper","context","margin","ratio","originX","left","originY","top","save","setTransform","scale","translate","forEach","dashArray","line","strokeDasharray","split","map","d","strokeStyle","stroke","opacity","setLineDash","beginPath","moveTo","x1","y1","lineTo","x2","y2","restore","className","idx","rest","propTypes","string","oneOf","contextTypes","object","isRequired","number","customX","xScale","xAccessor","currentItem","mouseXY","snapX","x","Math","round","defaultProps","show","height","width","line1","line2"],"mappings":"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","file":"CrossHairCursor.js","sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport GenericComponent, { getMouseCanvas } from \"../GenericComponent\";\r\n\r\nimport { hexToRGBA, isDefined, isNotDefined, strokeDashTypes, getStrokeDasharray } from \"../utils\";\r\n\r\nclass CrossHairCursor extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t}\r\n\tdrawOnCanvas(ctx, moreProps) {\r\n\t\tconst lines = helper(this.props, moreProps);\r\n\r\n\t\tif (isDefined(lines)) {\r\n\r\n\t\t\tconst { margin, ratio } = this.context;\r\n\t\t\tconst originX = 0.5 * ratio + margin.left;\r\n\t\t\tconst originY = 0.5 * ratio + margin.top;\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.setTransform(1, 0, 0, 1, 0, 0);\r\n\t\t\tctx.scale(ratio, ratio);\r\n\r\n\t\t\tctx.translate(originX, originY);\r\n\r\n\t\t\tlines.forEach(line => {\r\n\t\t\t\tconst dashArray = getStrokeDasharray(line.strokeDasharray).split(\",\").map(d => +d);\r\n\r\n\t\t\t\tctx.strokeStyle = hexToRGBA(line.stroke, line.opacity);\r\n\t\t\t\tctx.setLineDash(dashArray);\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(line.x1, line.y1);\r\n\t\t\t\tctx.lineTo(line.x2, line.y2);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t});\r\n\r\n\t\t\tctx.restore();\r\n\t\t}\r\n\t}\r\n\trenderSVG(moreProps) {\r\n\t\tconst { className } = this.props;\r\n\t\tconst lines = helper(this.props, moreProps);\r\n\r\n\t\tif (isNotDefined(lines)) return null;\r\n\r\n\t\treturn (\r\n\t\t\t<g className={`react-stockcharts-crosshair ${className}`}>\r\n\t\t\t\t{lines.map(({ strokeDasharray, ...rest }, idx) =>\r\n\t\t\t\t\t<line\r\n\t\t\t\t\t\tkey={idx}\r\n\t\t\t\t\t\tstrokeDasharray={getStrokeDasharray(strokeDasharray)}\r\n\t\t\t\t\t\t{...rest} />)}\r\n\t\t\t</g>\r\n\t\t);\r\n\t}\r\n\trender() {\r\n\t\treturn <GenericComponent\r\n\t\t\tsvgDraw={this.renderSVG}\r\n\t\t\tclip={false}\r\n\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\t\t\tcanvasToDraw={getMouseCanvas}\r\n\t\t\tdrawOn={[\"mousemove\", \"pan\", \"drag\"]}\r\n\t\t/>;\r\n\t}\r\n}\r\n\r\nCrossHairCursor.propTypes = {\r\n\tclassName: PropTypes.string,\r\n\tstrokeDasharray: PropTypes.oneOf(strokeDashTypes),\r\n};\r\n\r\nCrossHairCursor.contextTypes = {\r\n\tmargin: PropTypes.object.isRequired,\r\n\tratio: PropTypes.number.isRequired,\r\n\t// xScale for getting update event upon pan end, this is needed to get past the PureComponent shouldComponentUpdate\r\n\t// xScale: PropTypes.func.isRequired,\r\n};\r\n\r\nfunction customX(props, moreProps) {\r\n\tconst { xScale, xAccessor, currentItem, mouseXY } = moreProps;\r\n\tconst { snapX } = props;\r\n\tconst x = snapX\r\n\t\t? Math.round(xScale(xAccessor(currentItem)))\r\n\t\t: mouseXY[0];\r\n\treturn x;\r\n}\r\n\r\n\r\nCrossHairCursor.defaultProps = {\r\n\tstroke: \"#000000\",\r\n\topacity: 0.3,\r\n\tstrokeDasharray: \"ShortDash\",\r\n\tsnapX: true,\r\n\tcustomX,\r\n};\r\n\r\nfunction helper(props, moreProps) {\r\n\tconst {\r\n\t\tmouseXY, currentItem, show, height, width\r\n\t} = moreProps;\r\n\r\n\tconst { customX, stroke, opacity, strokeDasharray } = props;\r\n\r\n\tif (!show || isNotDefined(currentItem)) return null;\r\n\r\n\tconst line1 = {\r\n\t\tx1: 0,\r\n\t\tx2: width,\r\n\t\ty1: mouseXY[1],\r\n\t\ty2: mouseXY[1],\r\n\t\tstroke, strokeDasharray, opacity,\r\n\t};\r\n\tconst x = customX(props, moreProps);\r\n\r\n\tconst line2 = {\r\n\t\tx1: x,\r\n\t\tx2: x,\r\n\t\ty1: 0,\r\n\t\ty2: height,\r\n\t\tstroke, strokeDasharray, opacity,\r\n\t};\r\n\treturn [line1, line2];\r\n}\r\n\r\nexport default CrossHairCursor;\r\n"]}