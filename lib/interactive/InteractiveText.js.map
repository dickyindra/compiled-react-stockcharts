{"version":3,"sources":["../../../src/lib/interactive/InteractiveText.js"],"names":["InteractiveText","props","handleDraw","bind","handleDrag","handleDragComplete","terminate","saveNodeType","getSelectionState","nodes","state","index","position","setState","override","moreProps","textList","newTextList","map","each","idx","selected","onDragComplete","xyValue","current","start","end","e","enabled","mouseXY","mouseY","yScale","chartConfig","xAccessor","currentItem","invert","defaultText","onChoosePosition","newText","hoverText","defaultHoverText","defaultProps","propTypes","func","isRequired","onSelect","shape","bgFill","string","bgOpacity","number","bgStrokeWidth","bgStroke","textFill","fontFamily","fontWeight","fontStyle","fontSize","text","object","array","bool","enable","bgHeight","bgWidth","selectedText","contextTypes","subscribe","unsubscribe","generateSubscriptionId","chartId","oneOfType"],"mappings":"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","file":"InteractiveText.js","sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport { isDefined, noop } from \"../utils\";\r\n\r\nimport {\r\n\tgetValueFromOverride,\r\n\tterminate,\r\n\tsaveNodeType,\r\n\tisHoverForInteractiveType,\r\n} from \"./utils\";\r\nimport EachText from \"./wrapper/EachText\";\r\nimport HoverTextNearMouse from \"./components/HoverTextNearMouse\";\r\nimport GenericChartComponent from \"../GenericChartComponent\";\r\nimport { getMouseCanvas } from \"../GenericComponent\";\r\n\r\nclass InteractiveText extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.handleDraw = this.handleDraw.bind(this);\r\n\t\tthis.handleDrag = this.handleDrag.bind(this);\r\n\t\tthis.handleDragComplete = this.handleDragComplete.bind(this);\r\n\t\tthis.terminate = terminate.bind(this);\r\n\r\n\t\tthis.saveNodeType = saveNodeType.bind(this);\r\n\t\tthis.getSelectionState = isHoverForInteractiveType(\"textList\")\r\n\t\t\t.bind(this);\r\n\r\n\t\tthis.nodes = [];\r\n\t\tthis.state = {};\r\n\t}\r\n\thandleDrag(index, position) {\r\n\t\tthis.setState({\r\n\t\t\toverride: {\r\n\t\t\t\tindex,\r\n\t\t\t\tposition,\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\thandleDragComplete(moreProps) {\r\n\t\tconst { override } = this.state;\r\n\t\tif (isDefined(override)) {\r\n\t\t\tconst { textList } = this.props;\r\n\t\t\tconst newTextList = textList\r\n\t\t\t\t.map((each, idx) => {\r\n\t\t\t\t\tconst selected = (idx === override.index);\r\n\t\t\t\t\treturn selected\r\n\t\t\t\t\t\t? {\r\n\t\t\t\t\t\t\t...each,\r\n\t\t\t\t\t\t\tposition: override.position,\r\n\t\t\t\t\t\t\tselected,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t: {\r\n\t\t\t\t\t\t\t...each,\r\n\t\t\t\t\t\t\tselected\r\n\t\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\tthis.setState({\r\n\t\t\t\toverride: null,\r\n\t\t\t}, () => {\r\n\t\t\t\tthis.props.onDragComplete(newTextList, moreProps);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\thandleDrawLine(xyValue) {\r\n\t\tconst { current } = this.state;\r\n\r\n\t\tif (isDefined(current) && isDefined(current.start)) {\r\n\t\t\tthis.setState({\r\n\t\t\t\tcurrent: {\r\n\t\t\t\t\tstart: current.start,\r\n\t\t\t\t\tend: xyValue,\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\thandleDraw(moreProps, e) {\r\n\t\tconst { enabled } = this.props;\r\n\t\tif (enabled) {\r\n\t\t\tconst {\r\n\t\t\t\tmouseXY: [, mouseY],\r\n\t\t\t\tchartConfig: { yScale },\r\n\t\t\t\txAccessor,\r\n\t\t\t\tcurrentItem,\r\n\t\t\t} = moreProps;\r\n\r\n\t\t\tconst xyValue = [xAccessor(currentItem), yScale.invert(mouseY)];\r\n\r\n\t\t\tconst { defaultText, onChoosePosition } = this.props;\r\n\r\n\t\t\tconst newText = {\r\n\t\t\t\t...defaultText,\r\n\t\t\t\tposition: xyValue,\r\n\t\t\t};\r\n\t\t\tonChoosePosition(newText, moreProps, e);\r\n\t\t}/*  else {\r\n\t\t\tthis.handleClick(moreProps, e);\r\n\t\t} */\r\n\t}\r\n\trender() {\r\n\t\tconst { textList, defaultText, hoverText } = this.props;\r\n\t\tconst { override } = this.state;\r\n\t\treturn <g>\r\n\t\t\t{textList.map((each, idx) => {\r\n\t\t\t\tconst defaultHoverText = InteractiveText.defaultProps.hoverText;\r\n\t\t\t\tconst props = {\r\n\t\t\t\t\t...defaultText,\r\n\t\t\t\t\t...each,\r\n\t\t\t\t\thoverText: {\r\n\t\t\t\t\t\t...defaultHoverText,\r\n\t\t\t\t\t\t...hoverText,\r\n\t\t\t\t\t\t...(each.hoverText || {})\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t\treturn <EachText key={idx}\r\n\t\t\t\t\tref={this.saveNodeType(idx)}\r\n\t\t\t\t\tindex={idx}\r\n\t\t\t\t\t{...props}\r\n\t\t\t\t\tselected={each.selected}\r\n\t\t\t\t\tposition={getValueFromOverride(override, idx, \"position\", each.position)}\r\n\r\n\t\t\t\t\tonDrag={this.handleDrag}\r\n\t\t\t\t\tonDragComplete={this.handleDragComplete}\r\n\t\t\t\t\tedgeInteractiveCursor=\"react-stockcharts-move-cursor\"\r\n\t\t\t\t/>;\r\n\t\t\t})}\r\n\t\t\t<GenericChartComponent\r\n\r\n\t\t\t\tonClick={this.handleDraw}\r\n\r\n\t\t\t\tsvgDraw={noop}\r\n\t\t\t\tcanvasDraw={noop}\r\n\t\t\t\tcanvasToDraw={getMouseCanvas}\r\n\r\n\t\t\t\tdrawOn={[\"mousemove\", \"pan\"]}\r\n\t\t\t/>;\r\n\t\t</g>;\r\n\t}\r\n}\r\n\r\nInteractiveText.propTypes = {\r\n\tonChoosePosition: PropTypes.func.isRequired,\r\n\tonDragComplete: PropTypes.func.isRequired,\r\n\tonSelect: PropTypes.func,\r\n\r\n\tdefaultText: PropTypes.shape({\r\n\t\tbgFill: PropTypes.string.isRequired,\r\n\t\tbgOpacity: PropTypes.number.isRequired,\r\n\t\tbgStrokeWidth: PropTypes.number,\r\n\t\tbgStroke: PropTypes.string,\r\n\t\ttextFill: PropTypes.string.isRequired,\r\n\t\tfontFamily: PropTypes.string.isRequired,\r\n\t\tfontWeight: PropTypes.string.isRequired,\r\n\t\tfontStyle: PropTypes.string.isRequired,\r\n\t\tfontSize: PropTypes.number.isRequired,\r\n\t\ttext: PropTypes.string.isRequired,\r\n\t}).isRequired,\r\n\r\n\thoverText: PropTypes.object.isRequired,\r\n\ttextList: PropTypes.array.isRequired,\r\n\tenabled: PropTypes.bool.isRequired,\r\n};\r\n\r\nInteractiveText.defaultProps = {\r\n\tonChoosePosition: noop,\r\n\tonDragComplete: noop,\r\n\tonSelect: noop,\r\n\r\n\tdefaultText: {\r\n\t\tbgFill: \"#D3D3D3\",\r\n\t\tbgOpacity: 1,\r\n\t\tbgStrokeWidth: 1,\r\n\t\ttextFill: \"#F10040\",\r\n\t\tfontFamily: \"Helvetica Neue, Helvetica, Arial, sans-serif\",\r\n\t\tfontSize: 12,\r\n\t\tfontStyle: \"normal\",\r\n\t\tfontWeight: \"normal\",\r\n\t\ttext: \"Lorem ipsum...\"\r\n\t},\r\n\thoverText: {\r\n\t\t...HoverTextNearMouse.defaultProps,\r\n\t\tenable: true,\r\n\t\tbgHeight: \"auto\",\r\n\t\tbgWidth: \"auto\",\r\n\t\ttext: \"Click to select object\",\r\n\t\tselectedText: \"\",\r\n\t},\r\n\ttextList: [],\r\n};\r\n\r\nInteractiveText.contextTypes = {\r\n\tsubscribe: PropTypes.func.isRequired,\r\n\tunsubscribe: PropTypes.func.isRequired,\r\n\tgenerateSubscriptionId: PropTypes.func.isRequired,\r\n\tchartId: PropTypes.oneOfType([PropTypes.number, PropTypes.string]).isRequired,\r\n};\r\n\r\nexport default InteractiveText;\r\n"]}