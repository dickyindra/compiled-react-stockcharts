{"version":3,"sources":["../../../src/lib/indicator/elderImpulse.js"],"names":["macdSource","emaSource","base","type","ALGORITHM_TYPE","stroke","fill","undefined","underlyingAlgorithm","windowSize","undefinedValue","accumulator","prev","curr","Error","prevMACDDivergence","divergence","currMACDDivergence","prevEMA","currEMA","mergedAlgorithm","algorithm","merge","datum","indicator","elderImpulse","data","options","newData","x","arguments","length"],"mappings":";;;;;;;;kBASe,YAAW;;AAEzB,KAAIA,mBAAJ;AAAA,KAAgBC,kBAAhB;;AAEA,KAAMC,OAAO,+BACXC,IADW,CACNC,cADM;AAEZ;AAFY,EAGXC,MAHW,CAGJ,0CAAkBA,MAHd,EAIXC,IAJW,CAINC,SAJM,CAAb;;AAMA,KAAMC,sBAAsB,4BAC1BC,UAD0B,CACf,CADe,EAE1BC,cAF0B,CAEX,SAFW,EAG1BC,WAH0B,CAGd,gBAAkB;AAAA;AAAA,MAAhBC,IAAgB;AAAA,MAAVC,IAAU;;AAC9B,MAAI,yBAAab,UAAb,CAAJ,EAA8B,MAAM,IAAIc,KAAJ,iCAAwCV,cAAxC,iBAAN;AAC9B,MAAI,yBAAaH,SAAb,CAAJ,EAA6B,MAAM,IAAIa,KAAJ,gCAAuCV,cAAvC,iBAAN;;AAE7B,MAAI,sBAAUJ,WAAWY,IAAX,CAAV,KAA+B,sBAAUX,UAAUW,IAAV,CAAV,CAAnC,EAA+D;AAC9D,OAAMG,qBAAqBf,WAAWY,IAAX,EAAiBI,UAA5C;AACA,OAAMC,qBAAqBjB,WAAWa,IAAX,EAAiBG,UAA5C;;AAEA,OAAME,UAAUjB,UAAUW,IAAV,CAAhB;AACA,OAAMO,UAAUlB,UAAUY,IAAV,CAAhB;;AAEA,OAAII,sBAAsBF,kBAAtB,IACAI,WAAWD,OADf,EACwB,OAAO,IAAP;;AAExB,OAAID,sBAAsBF,kBAAtB,IACAI,WAAWD,OADf,EACwB,OAAO,MAAP;AACxB;AACD,SAAO,SAAP;AACA,EArB0B,CAA5B;;AAuBA,KAAME,kBAAkB,oBACtBC,SADsB,CACZb,mBADY,EAEtBc,KAFsB,CAEhB,UAACC,KAAD,EAAQC,SAAR,EAAsB;AAAED,QAAME,YAAN,GAAqBD,SAArB;AAAiC,EAFzC,CAAxB;;AAIA;AACA,KAAIA,YAAY,SAAZA,SAAY,CAASE,IAAT,EAA0C;AAAA,MAA3BC,OAA2B,uEAAjB,EAAEL,OAAO,IAAT,EAAiB;;AACzD,MAAMM,UAAUD,QAAQL,KAAR,GACbF,gBAAgBM,IAAhB,CADa,GAEblB,oBAAoBkB,IAApB,CAFH;;AAIA,SAAOE,OAAP;AACA,EAND;AAOAJ,WAAUxB,UAAV,GAAuB,UAAS6B,CAAT,EAAY;AAClC,MAAI,CAACC,UAAUC,MAAf,EAAuB,OAAO/B,UAAP;AACvBA,eAAa6B,CAAb;AACA,SAAOL,SAAP;AACA,EAJD;AAKAA,WAAUvB,SAAV,GAAsB,UAAS4B,CAAT,EAAY;AACjC,MAAI,CAACC,UAAUC,MAAf,EAAuB,OAAO9B,SAAP;AACvBA,cAAY4B,CAAZ;AACA,SAAOL,SAAP;AACA,EAJD;AAKA,oBAAOA,SAAP,EAAkBtB,IAAlB,EAAwB,IAAxB,EAA8B,MAA9B,EAAsC,MAAtC,EAA8C,QAA9C;AACA;AACA,oBAAOsB,SAAP,EAAkBJ,eAAlB,EAAmC,OAAnC,EAA4C,eAA5C;;AAEA,QAAOI,SAAP;AACA,C;;AAnED;;AAEA;;AACA;;;;;;AAEA,IAAMpB,iBAAiB,cAAvB","file":"elderImpulse.js","sourcesContent":["\r\n\r\nimport { rebind, isDefined, isNotDefined, merge, slidingWindow } from \"../utils\";\r\n\r\nimport { ElderImpulse as appearanceOptions } from \"./defaultOptionsForAppearance\";\r\nimport baseIndicator from \"./baseIndicator\";\r\n\r\nconst ALGORITHM_TYPE = \"ElderImpulse\";\r\n\r\nexport default function() {\r\n\r\n\tlet macdSource, emaSource;\r\n\r\n\tconst base = baseIndicator()\r\n\t\t.type(ALGORITHM_TYPE)\r\n\t\t// .stroke(d => stroke[d.elderImpulse])\r\n\t\t.stroke(appearanceOptions.stroke)\r\n\t\t.fill(undefined);\r\n\r\n\tconst underlyingAlgorithm = slidingWindow()\r\n\t\t.windowSize(2)\r\n\t\t.undefinedValue(\"neutral\")\r\n\t\t.accumulator(([prev, curr]) => {\r\n\t\t\tif (isNotDefined(macdSource)) throw new Error(`macdSource not defined for ${ALGORITHM_TYPE} calculator`);\r\n\t\t\tif (isNotDefined(emaSource)) throw new Error(`emaSource not defined for ${ALGORITHM_TYPE} calculator`);\r\n\r\n\t\t\tif (isDefined(macdSource(prev)) && isDefined(emaSource(prev))) {\r\n\t\t\t\tconst prevMACDDivergence = macdSource(prev).divergence;\r\n\t\t\t\tconst currMACDDivergence = macdSource(curr).divergence;\r\n\r\n\t\t\t\tconst prevEMA = emaSource(prev);\r\n\t\t\t\tconst currEMA = emaSource(curr);\r\n\r\n\t\t\t\tif (currMACDDivergence >= prevMACDDivergence\r\n\t\t\t\t\t&& currEMA >= prevEMA) return \"up\";\r\n\r\n\t\t\t\tif (currMACDDivergence <= prevMACDDivergence\r\n\t\t\t\t\t&& currEMA <= prevEMA) return \"down\";\r\n\t\t\t}\r\n\t\t\treturn \"neutral\";\r\n\t\t});\r\n\r\n\tconst mergedAlgorithm = merge()\r\n\t\t.algorithm(underlyingAlgorithm)\r\n\t\t.merge((datum, indicator) => { datum.elderImpulse = indicator; });\r\n\r\n\t// eslint-disable-next-line prefer-const\r\n\tlet indicator = function(data, options = { merge: true }) {\r\n\t\tconst newData = options.merge\r\n\t\t\t? mergedAlgorithm(data)\r\n\t\t\t: underlyingAlgorithm(data);\r\n\r\n\t\treturn newData;\r\n\t};\r\n\tindicator.macdSource = function(x) {\r\n\t\tif (!arguments.length) return macdSource;\r\n\t\tmacdSource = x;\r\n\t\treturn indicator;\r\n\t};\r\n\tindicator.emaSource = function(x) {\r\n\t\tif (!arguments.length) return emaSource;\r\n\t\temaSource = x;\r\n\t\treturn indicator;\r\n\t};\r\n\trebind(indicator, base, \"id\", \"echo\", \"type\", \"stroke\");\r\n\t// rebind(indicator, underlyingAlgorithm, \"windowSize\", \"movingAverageType\", \"multiplier\", \"source\");\r\n\trebind(indicator, mergedAlgorithm, \"merge\", \"skipUndefined\");\r\n\r\n\treturn indicator;\r\n}\r\n"]}