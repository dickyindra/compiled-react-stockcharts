{"version":3,"sources":["../../../src/lib/series/BarSeries.js"],"names":["BarSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","swapScales","xAccessor","bars","getBars","gAttr","className","clip","propTypes","baseAt","oneOfType","number","func","stroke","bool","width","yAccessor","isRequired","opacity","fill","string","minHeight","defaultProps","xScale","plotData","yScale","chartConfig","getFill","getBase","widthFunctor","offset","Math","floor","filter","d","map","yValue","y","x","round","h","height"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AAEA;;;;AACA;;AAEA;;;;AAQA;;;;;;;;;;IAEMA,S;;;AACL,oBAAYC,KAAZ,EAAmB;AAAA;;AAAA,oHACZA,KADY;;AAElB,QAAKC,SAAL,GAAiB,MAAKA,SAAL,CAAeC,IAAf,OAAjB;AACA,QAAKC,YAAL,GAAoB,MAAKA,YAAL,CAAkBD,IAAlB,OAApB;AAHkB;AAIlB;;;;+BACYE,G,EAAKC,S,EAAW;AAC5B,OAAI,KAAKL,KAAL,CAAWM,UAAf,EAA2B;AAAA,QAClBC,SADkB,GACJF,SADI,CAClBE,SADkB;;AAE1B,8CACCH,GADD,EAEC,KAAKJ,KAFN,EAGCK,SAHD,EAICE,SAJD;AAOA,IATD,MASO;AACN,QAAMC,OAAOC,QAAQ,KAAKT,KAAb,EAAoBK,SAApB,CAAb;AACA,yCAAc,KAAKL,KAAnB,EAA0BI,GAA1B,EAA+BI,IAA/B;AACA;AACD;;;4BACSH,S,EAAW;AACpB,OAAMK,QAAQ;AACbC,eAAW,KAAKX,KAAL,CAAWW;AADT,IAAd;;AAIA,OAAI,KAAKX,KAAL,CAAWM,UAAf,EAA2B;AAAA,QAClBC,SADkB,GACJF,SADI,CAClBE,SADkB;;AAE1B,WACC;AAAA;AAAOG,UAAP;AACE,sCAAU,KAAKV,KAAf,EAAsBK,SAAtB,EAAiCE,SAAjC;AADF,KADD;AAKA,IAPD,MAOO;AACN,QAAMC,OAAOC,QAAQ,KAAKT,KAAb,EAAoBK,SAApB,CAAb;AACA,WAAO;AAAA;AAAOK,UAAP;AAAe,wCAAY,KAAKV,KAAjB,EAAwBQ,IAAxB;AAAf,KAAP;AACA;AACD;;;2BACQ;AAAA,OACAI,IADA,GACS,KAAKZ,KADd,CACAY,IADA;;;AAGR,UACC;AACC,UAAMA,IADP;AAEC,aAAS,KAAKX,SAFf;AAGC,iDAHD;AAIC,gBAAY,KAAKE,YAJlB;AAKC,YAAQ,CAAC,KAAD;AALT,KADD;AASA;;;;;;AAGFJ,UAAUc,SAAV,GAAsB;AACrBC,SAAQ,oBAAUC,SAAV,CAAoB,CAAC,oBAAUC,MAAX,EAAmB,oBAAUC,IAA7B,CAApB,CADa;AAErBC,SAAQ,oBAAUC,IAFG;AAGrBC,QAAO,oBAAUL,SAAV,CAAoB,CAAC,oBAAUC,MAAX,EAAmB,oBAAUC,IAA7B,CAApB,CAHc;AAIrBI,YAAW,oBAAUJ,IAAV,CAAeK,UAJL;AAKrBC,UAAS,oBAAUP,MALE;AAMrBQ,OAAM,oBAAUT,SAAV,CAAoB,CAAC,oBAAUE,IAAX,EAAiB,oBAAUQ,MAA3B,CAApB,CANe;AAOrBd,YAAW,oBAAUI,SAAV,CAAoB,CAAC,oBAAUE,IAAX,EAAiB,oBAAUQ,MAA3B,CAApB,CAPU;AAQrBb,OAAM,oBAAUO,IARK;AASrBb,aAAY,oBAAUa,IATD;AAUrBO,YAAW,oBAAUV;AAVA,CAAtB;;AAaAjB,UAAU4B,YAAV,GAAyB,2BAAiBA,YAA1C;;kBAEe5B,S;;AAEf;;;;;;;;;;;AAUA,SAASU,OAAT,CAAiBT,KAAjB,EAAwBK,SAAxB,EAAmC;AAAA,KAC1BS,MAD0B,GACqBd,KADrB,CAC1Bc,MAD0B;AAAA,KAClBU,IADkB,GACqBxB,KADrB,CAClBwB,IADkB;AAAA,KACZN,MADY,GACqBlB,KADrB,CACZkB,MADY;AAAA,KACJG,SADI,GACqBrB,KADrB,CACJqB,SADI;AAAA,KACOK,SADP,GACqB1B,KADrB,CACO0B,SADP;AAAA,KAGjCE,MAHiC,GAO9BvB,SAP8B,CAGjCuB,MAHiC;AAAA,KAIjCrB,SAJiC,GAO9BF,SAP8B,CAIjCE,SAJiC;AAAA,KAKjCsB,QALiC,GAO9BxB,SAP8B,CAKjCwB,QALiC;AAAA,KAMlBC,MANkB,GAO9BzB,SAP8B,CAMjC0B,WANiC,CAMlBD,MANkB;;;AASlC,KAAME,UAAU,oBAAQR,IAAR,CAAhB;AACA,KAAMS,UAAU,oBAAQnB,MAAR,CAAhB;;AAEA,KAAMoB,eAAe,oBAAQlC,MAAMoB,KAAd,CAArB;;AAEA,KAAMA,QAAQc,aAAalC,KAAb,EAAoB;AACjC4B,gBADiC;AAEjCrB,sBAFiC;AAGjCsB;AAHiC,EAApB,CAAd;AAKA;;;;AAIA,KAAMM,SAASC,KAAKC,KAAL,CAAW,MAAMjB,KAAjB,CAAf;;AAEA,KAAMZ,OAAOqB,SACXS,MADW,CACJ,UAACC,CAAD;AAAA,SAAO,sBAAUlB,UAAUkB,CAAV,CAAV,CAAP;AAAA,EADI,EAEXC,GAFW,CAEP,UAACD,CAAD,EAAO;AACX,MAAME,SAASpB,UAAUkB,CAAV,CAAf;AACA,MAAIG,IAAIZ,OAAOW,MAAP,CAAR;;AAEA,MAAME,IAAIP,KAAKQ,KAAL,CAAWhB,OAAOrB,UAAUgC,CAAV,CAAP,CAAX,IAAmCJ,MAA7C;AACA,MAAIU,IAAIZ,QAAQL,MAAR,EAAgBE,MAAhB,EAAwBS,CAAxB,IAA6BT,OAAOW,MAAP,CAArC;;AAEA,MAAII,IAAI,CAAR,EAAW;AACVH,OAAIA,IAAIG,CAAR;AACAA,OAAI,CAACA,CAAL;AACA;;AAED,MAAInB,aAAae,SAAS,CAA1B,EAA6B;AAC5B,OAAMK,SAASV,KAAKQ,KAAL,CAAWC,CAAX,CAAf;;AAEA,OAAIC,SAASpB,SAAb,EAAwB;AACvBgB,QAAIT,QAAQL,MAAR,EAAgBE,MAAhB,EAAwBS,CAAxB,IAA6Bb,SAAjC;AACAmB,QAAInB,SAAJ;AACA;AACD;;AAED,SAAO;AACN;AACAiB,OAFM;AAGND,MAAGN,KAAKQ,KAAL,CAAWF,CAAX,CAHG;AAINI,WAAQV,KAAKQ,KAAL,CAAWC,CAAX,CAJF;AAKNzB,UAAOe,SAAS,CALV;AAMNX,SAAMQ,QAAQO,CAAR,EAAW,CAAX,CANA;AAONrB,WAAQA,SAASc,QAAQO,CAAR,EAAW,CAAX,CAAT,GAAyB;AAP3B,GAAP;AASA,EAhCW,CAAb;;AAkCA,QAAO/B,IAAP;AACA","file":"BarSeries.js","sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport GenericChartComponent from \"../GenericChartComponent\";\nimport { getAxisCanvas } from \"../GenericComponent\";\n\nimport StackedBarSeries, {\n\tdrawOnCanvasHelper,\n\tdrawOnCanvas2,\n\tgetBarsSVG2,\n\tsvgHelper,\n\tidentityStack,\n} from \"./StackedBarSeries\";\n\nimport { functor, isDefined } from \"../utils\";\n\nclass BarSeries extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.renderSVG = this.renderSVG.bind(this);\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\n\t}\n\tdrawOnCanvas(ctx, moreProps) {\n\t\tif (this.props.swapScales) {\n\t\t\tconst { xAccessor } = moreProps;\n\t\t\tdrawOnCanvasHelper(\n\t\t\t\tctx,\n\t\t\t\tthis.props,\n\t\t\t\tmoreProps,\n\t\t\t\txAccessor,\n\t\t\t\tidentityStack\n\t\t\t);\n\t\t} else {\n\t\t\tconst bars = getBars(this.props, moreProps);\n\t\t\tdrawOnCanvas2(this.props, ctx, bars);\n\t\t}\n\t}\n\trenderSVG(moreProps) {\n\t\tconst gAttr = {\n\t\t\tclassName: this.props.className,\n\t\t};\n\n\t\tif (this.props.swapScales) {\n\t\t\tconst { xAccessor } = moreProps;\n\t\t\treturn (\n\t\t\t\t<g {...gAttr}>\n\t\t\t\t\t{svgHelper(this.props, moreProps, xAccessor, identityStack)}\n\t\t\t\t</g>\n\t\t\t);\n\t\t} else {\n\t\t\tconst bars = getBars(this.props, moreProps);\n\t\t\treturn <g {...gAttr}>{getBarsSVG2(this.props, bars)}</g>;\n\t\t}\n\t}\n\trender() {\n\t\tconst { clip } = this.props;\n\n\t\treturn (\n\t\t\t<GenericChartComponent\n\t\t\t\tclip={clip}\n\t\t\t\tsvgDraw={this.renderSVG}\n\t\t\t\tcanvasToDraw={getAxisCanvas}\n\t\t\t\tcanvasDraw={this.drawOnCanvas}\n\t\t\t\tdrawOn={[\"pan\"]}\n\t\t\t/>\n\t\t);\n\t}\n}\n\nBarSeries.propTypes = {\n\tbaseAt: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n\tstroke: PropTypes.bool,\n\twidth: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n\tyAccessor: PropTypes.func.isRequired,\n\topacity: PropTypes.number,\n\tfill: PropTypes.oneOfType([PropTypes.func, PropTypes.string]),\n\tclassName: PropTypes.oneOfType([PropTypes.func, PropTypes.string]),\n\tclip: PropTypes.bool,\n\tswapScales: PropTypes.bool,\n\tminHeight: PropTypes.number,\n};\n\nBarSeries.defaultProps = StackedBarSeries.defaultProps;\n\nexport default BarSeries;\n\n/*\n Initially, this program was using StackedBarSeries.getBars\n to benefit from code reuse and having a single place that\n contains the logic for drawing all types of bar charts\n simple, grouped, horizontal, but turnes out\n making it highly cuztimizable also made it slow for the\n most simple case, a regular bar chart.\n This function contains just the necessary logic\n to create bars\n*/\nfunction getBars(props, moreProps) {\n\tconst { baseAt, fill, stroke, yAccessor, minHeight } = props;\n\tconst {\n\t\txScale,\n\t\txAccessor,\n\t\tplotData,\n\t\tchartConfig: { yScale },\n\t} = moreProps;\n\n\tconst getFill = functor(fill);\n\tconst getBase = functor(baseAt);\n\n\tconst widthFunctor = functor(props.width);\n\n\tconst width = widthFunctor(props, {\n\t\txScale,\n\t\txAccessor,\n\t\tplotData,\n\t});\n\t/*\n\tconst barWidth = Math.round(width);\n\tconst offset = Math.round(barWidth === 1 ? 0 : 0.5 * barWidth);\n\t*/\n\tconst offset = Math.floor(0.5 * width);\n\n\tconst bars = plotData\n\t\t.filter((d) => isDefined(yAccessor(d)))\n\t\t.map((d) => {\n\t\t\tconst yValue = yAccessor(d);\n\t\t\tlet y = yScale(yValue);\n\n\t\t\tconst x = Math.round(xScale(xAccessor(d))) - offset;\n\t\t\tlet h = getBase(xScale, yScale, d) - yScale(yValue);\n\n\t\t\tif (h < 0) {\n\t\t\t\ty = y + h;\n\t\t\t\th = -h;\n\t\t\t}\n\n\t\t\tif (minHeight && yValue > 0) {\n\t\t\t\tconst height = Math.round(h);\n\n\t\t\t\tif (height < minHeight) {\n\t\t\t\t\ty = getBase(xScale, yScale, d) - minHeight;\n\t\t\t\t\th = minHeight;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t// type: \"line\"\n\t\t\t\tx,\n\t\t\t\ty: Math.round(y),\n\t\t\t\theight: Math.round(h),\n\t\t\t\twidth: offset * 2,\n\t\t\t\tfill: getFill(d, 0),\n\t\t\t\tstroke: stroke ? getFill(d, 0) : \"none\",\n\t\t\t};\n\t\t});\n\n\treturn bars;\n}\n"]}