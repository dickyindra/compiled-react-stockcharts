{"version":3,"sources":["../../../src/lib/series/BarSeries.js"],"names":["BarSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","swapScales","xAccessor","bars","getBars","gAttr","className","clip","propTypes","baseAt","oneOfType","number","func","stroke","bool","width","yAccessor","isRequired","opacity","fill","string","minHeight","defaultProps","xScale","plotData","yScale","chartConfig","getFill","getBase","widthFunctor","offset","Math","floor","filter","d","map","yValue","y","x","round","h","console","log","ifone","height","iftwo"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AAEA;;;;AACA;;AAEA;;;;AAQA;;;;;;;;;;IAEMA,S;;;AACF,uBAAYC,KAAZ,EAAmB;AAAA;;AAAA,0HACTA,KADS;;AAEf,cAAKC,SAAL,GAAiB,MAAKA,SAAL,CAAeC,IAAf,OAAjB;AACA,cAAKC,YAAL,GAAoB,MAAKA,YAAL,CAAkBD,IAAlB,OAApB;AAHe;AAIlB;;;;qCACYE,G,EAAKC,S,EAAW;AACzB,gBAAI,KAAKL,KAAL,CAAWM,UAAf,EAA2B;AAAA,oBACfC,SADe,GACDF,SADC,CACfE,SADe;;AAEvB,0DACIH,GADJ,EAEI,KAAKJ,KAFT,EAGIK,SAHJ,EAIIE,SAJJ;AAOH,aATD,MASO;AACH,oBAAMC,OAAOC,QAAQ,KAAKT,KAAb,EAAoBK,SAApB,CAAb;AACA,qDAAc,KAAKL,KAAnB,EAA0BI,GAA1B,EAA+BI,IAA/B;AACH;AACJ;;;kCACSH,S,EAAW;AACjB,gBAAMK,QAAQ;AACVC,2BAAW,KAAKX,KAAL,CAAWW;AADZ,aAAd;;AAIA,gBAAI,KAAKX,KAAL,CAAWM,UAAf,EAA2B;AAAA,oBACfC,SADe,GACDF,SADC,CACfE,SADe;;AAEvB,uBACI;AAAA;AAAOG,yBAAP;AACK,qDAAU,KAAKV,KAAf,EAAsBK,SAAtB,EAAiCE,SAAjC;AADL,iBADJ;AAKH,aAPD,MAOO;AACH,oBAAMC,OAAOC,QAAQ,KAAKT,KAAb,EAAoBK,SAApB,CAAb;AACA,uBAAO;AAAA;AAAOK,yBAAP;AAAe,uDAAY,KAAKV,KAAjB,EAAwBQ,IAAxB;AAAf,iBAAP;AACH;AACJ;;;iCACQ;AAAA,gBACGI,IADH,GACY,KAAKZ,KADjB,CACGY,IADH;;;AAGL,mBACI;AACI,sBAAMA,IADV;AAEI,yBAAS,KAAKX,SAFlB;AAGI,6DAHJ;AAII,4BAAY,KAAKE,YAJrB;AAKI,wBAAQ,CAAC,KAAD;AALZ,cADJ;AASH;;;;;;AAGLJ,UAAUc,SAAV,GAAsB;AAClBC,YAAQ,oBAAUC,SAAV,CAAoB,CAAC,oBAAUC,MAAX,EAAmB,oBAAUC,IAA7B,CAApB,CADU;AAElBC,YAAQ,oBAAUC,IAFA;AAGlBC,WAAO,oBAAUL,SAAV,CAAoB,CAAC,oBAAUC,MAAX,EAAmB,oBAAUC,IAA7B,CAApB,CAHW;AAIlBI,eAAW,oBAAUJ,IAAV,CAAeK,UAJR;AAKlBC,aAAS,oBAAUP,MALD;AAMlBQ,UAAM,oBAAUT,SAAV,CAAoB,CAAC,oBAAUE,IAAX,EAAiB,oBAAUQ,MAA3B,CAApB,CANY;AAOlBd,eAAW,oBAAUI,SAAV,CAAoB,CAAC,oBAAUE,IAAX,EAAiB,oBAAUQ,MAA3B,CAApB,CAPO;AAQlBb,UAAM,oBAAUO,IARE;AASlBb,gBAAY,oBAAUa,IATJ;AAUlBO,eAAW,oBAAUV;AAVH,CAAtB;;AAaAjB,UAAU4B,YAAV,GAAyB,2BAAiBA,YAA1C;;kBAEe5B,S;;AAEf;;;;;;;;;;;AAUA,SAASU,OAAT,CAAiBT,KAAjB,EAAwBK,SAAxB,EAAmC;AAAA,QACvBS,MADuB,GACwBd,KADxB,CACvBc,MADuB;AAAA,QACfU,IADe,GACwBxB,KADxB,CACfwB,IADe;AAAA,QACTN,MADS,GACwBlB,KADxB,CACTkB,MADS;AAAA,QACDG,SADC,GACwBrB,KADxB,CACDqB,SADC;AAAA,QACUK,SADV,GACwB1B,KADxB,CACU0B,SADV;AAAA,QAG3BE,MAH2B,GAO3BvB,SAP2B,CAG3BuB,MAH2B;AAAA,QAI3BrB,SAJ2B,GAO3BF,SAP2B,CAI3BE,SAJ2B;AAAA,QAK3BsB,QAL2B,GAO3BxB,SAP2B,CAK3BwB,QAL2B;AAAA,QAMZC,MANY,GAO3BzB,SAP2B,CAM3B0B,WAN2B,CAMZD,MANY;;;AAS/B,QAAME,UAAU,oBAAQR,IAAR,CAAhB;AACA,QAAMS,UAAU,oBAAQnB,MAAR,CAAhB;;AAEA,QAAMoB,eAAe,oBAAQlC,MAAMoB,KAAd,CAArB;;AAEA,QAAMA,QAAQc,aAAalC,KAAb,EAAoB;AAC9B4B,sBAD8B;AAE9BrB,4BAF8B;AAG9BsB;AAH8B,KAApB,CAAd;AAKA;;;;AAIA,QAAMM,SAASC,KAAKC,KAAL,CAAW,MAAMjB,KAAjB,CAAf;;AAEA,QAAMZ,OAAOqB,SACRS,MADQ,CACD,UAACC,CAAD;AAAA,eAAO,sBAAUlB,UAAUkB,CAAV,CAAV,CAAP;AAAA,KADC,EAERC,GAFQ,CAEJ,UAACD,CAAD,EAAO;AACR,YAAME,SAASpB,UAAUkB,CAAV,CAAf;AACA,YAAIG,IAAIZ,OAAOW,MAAP,CAAR;;AAEA,YAAME,IAAIP,KAAKQ,KAAL,CAAWhB,OAAOrB,UAAUgC,CAAV,CAAP,CAAX,IAAmCJ,MAA7C;AACA,YAAIU,IAAIZ,QAAQL,MAAR,EAAgBE,MAAhB,EAAwBS,CAAxB,IAA6BT,OAAOW,MAAP,CAArC;;AAEA,YAAII,IAAI,CAAR,EAAW;AACPH,gBAAIA,IAAIG,CAAR;AACAA,gBAAI,CAACA,CAAL;AACH;;AAEDC,gBAAQC,GAAR,CAAY,WAAZ,EAAyB;AACrBrB,uBAAWA,SADU;AAErBgB,eAAGA,CAFkB;AAGrBD,oBAAQA,MAHa;AAIrBO,mBAAOtB,aAAae,SAAS,CAJR;AAKrBQ,oBAAQb,KAAKQ,KAAL,CAAWC,CAAX,CALa;AAMrBK,mBAAOd,KAAKQ,KAAL,CAAWC,CAAX,IAAgBnB;AANF,SAAzB;;AASA,YAAIA,aAAae,SAAS,CAA1B,EAA6B;AACzB,gBAAMQ,SAASb,KAAKQ,KAAL,CAAWC,CAAX,CAAf;;AAEA,gBAAII,SAASvB,SAAb,EAAwB;AACpBmB,oBAAInB,SAAJ;AACH;AACJ;;AAEDoB,gBAAQC,GAAR,CAAY,WAAZ,EAAyBF,CAAzB;;AAEA,eAAO;AACH;AACAF,gBAFG;AAGHD,eAAGN,KAAKQ,KAAL,CAAWF,CAAX,CAHA;AAIHO,oBAAQb,KAAKQ,KAAL,CAAWC,CAAX,CAJL;AAKHzB,mBAAOe,SAAS,CALb;AAMHX,kBAAMQ,QAAQO,CAAR,EAAW,CAAX,CANH;AAOHrB,oBAAQA,SAASc,QAAQO,CAAR,EAAW,CAAX,CAAT,GAAyB;AAP9B,SAAP;AASH,KA1CQ,CAAb;;AA4CA,WAAO/B,IAAP;AACH","file":"BarSeries.js","sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport GenericChartComponent from \"../GenericChartComponent\";\nimport { getAxisCanvas } from \"../GenericComponent\";\n\nimport StackedBarSeries, {\n    drawOnCanvasHelper,\n    drawOnCanvas2,\n    getBarsSVG2,\n    svgHelper,\n    identityStack,\n} from \"./StackedBarSeries\";\n\nimport { functor, isDefined } from \"../utils\";\n\nclass BarSeries extends Component {\n    constructor(props) {\n        super(props);\n        this.renderSVG = this.renderSVG.bind(this);\n        this.drawOnCanvas = this.drawOnCanvas.bind(this);\n    }\n    drawOnCanvas(ctx, moreProps) {\n        if (this.props.swapScales) {\n            const { xAccessor } = moreProps;\n            drawOnCanvasHelper(\n                ctx,\n                this.props,\n                moreProps,\n                xAccessor,\n                identityStack\n            );\n        } else {\n            const bars = getBars(this.props, moreProps);\n            drawOnCanvas2(this.props, ctx, bars);\n        }\n    }\n    renderSVG(moreProps) {\n        const gAttr = {\n            className: this.props.className,\n        };\n\n        if (this.props.swapScales) {\n            const { xAccessor } = moreProps;\n            return (\n                <g {...gAttr}>\n                    {svgHelper(this.props, moreProps, xAccessor, identityStack)}\n                </g>\n            );\n        } else {\n            const bars = getBars(this.props, moreProps);\n            return <g {...gAttr}>{getBarsSVG2(this.props, bars)}</g>;\n        }\n    }\n    render() {\n        const { clip } = this.props;\n\n        return (\n            <GenericChartComponent\n                clip={clip}\n                svgDraw={this.renderSVG}\n                canvasToDraw={getAxisCanvas}\n                canvasDraw={this.drawOnCanvas}\n                drawOn={[\"pan\"]}\n            />\n        );\n    }\n}\n\nBarSeries.propTypes = {\n    baseAt: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n    stroke: PropTypes.bool,\n    width: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n    yAccessor: PropTypes.func.isRequired,\n    opacity: PropTypes.number,\n    fill: PropTypes.oneOfType([PropTypes.func, PropTypes.string]),\n    className: PropTypes.oneOfType([PropTypes.func, PropTypes.string]),\n    clip: PropTypes.bool,\n    swapScales: PropTypes.bool,\n    minHeight: PropTypes.number,\n};\n\nBarSeries.defaultProps = StackedBarSeries.defaultProps;\n\nexport default BarSeries;\n\n/*\n Initially, this program was using StackedBarSeries.getBars\n to benefit from code reuse and having a single place that\n contains the logic for drawing all types of bar charts\n simple, grouped, horizontal, but turnes out\n making it highly cuztimizable also made it slow for the\n most simple case, a regular bar chart.\n This function contains just the necessary logic\n to create bars\n*/\nfunction getBars(props, moreProps) {\n    const { baseAt, fill, stroke, yAccessor, minHeight } = props;\n    const {\n        xScale,\n        xAccessor,\n        plotData,\n        chartConfig: { yScale },\n    } = moreProps;\n\n    const getFill = functor(fill);\n    const getBase = functor(baseAt);\n\n    const widthFunctor = functor(props.width);\n\n    const width = widthFunctor(props, {\n        xScale,\n        xAccessor,\n        plotData,\n    });\n    /*\n\tconst barWidth = Math.round(width);\n\tconst offset = Math.round(barWidth === 1 ? 0 : 0.5 * barWidth);\n\t*/\n    const offset = Math.floor(0.5 * width);\n\n    const bars = plotData\n        .filter((d) => isDefined(yAccessor(d)))\n        .map((d) => {\n            const yValue = yAccessor(d);\n            let y = yScale(yValue);\n\n            const x = Math.round(xScale(xAccessor(d))) - offset;\n            let h = getBase(xScale, yScale, d) - yScale(yValue);\n\n            if (h < 0) {\n                y = y + h;\n                h = -h;\n            }\n\n            console.log(\"BarSeries\", {\n                minHeight: minHeight,\n                y: y,\n                yValue: yValue,\n                ifone: minHeight && yValue > 0,\n                height: Math.round(h),\n                iftwo: Math.round(h) < minHeight,\n            });\n\n            if (minHeight && yValue > 0) {\n                const height = Math.round(h);\n\n                if (height < minHeight) {\n                    h = minHeight;\n                }\n            }\n\n            console.log(\"BarSeries\", h);\n\n            return {\n                // type: \"line\"\n                x,\n                y: Math.round(y),\n                height: Math.round(h),\n                width: offset * 2,\n                fill: getFill(d, 0),\n                stroke: stroke ? getFill(d, 0) : \"none\",\n            };\n        });\n\n    return bars;\n}\n"]}